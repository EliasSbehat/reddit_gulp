"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var UI=function(){var t={LEFT:1,RIGHT:2},e={MAIN:1,COMMENTS:2},n={showView:"show-view",showMenu:"show-menu",mnml:"mnml",hide:"hide",swipe:"from-swipe",invisible:"invisible"},a={MENU:49,MAIN:50,DETAIL:51},i={loader:"<div class='loader'></div>",closeModalButton:"<a href='#close' class='close-form no-ndrln txt-cntr txt-bld'>&times;</a>",closeThreadButton:"<a href='#close' class='close-thread no-ndrln txt-cntr txt-bld' style='margin-top:38px;'>&times;</a>"},r={body:$("body"),mainWrap:$("#main-wrap"),detailWrap:$("#detail-wrap"),mainView:$(".main-view"),detailView:$(".detail-view")},s=e.MAIN,o=function(){return s},d=function(t){s=t},l=function(t){Header.el.subtitleText.text(t),Footer.el.subTitle.text(t)},c=function(){Header.el.btnNavBack.addClass(n.invisible),Header.el.subtitle.removeClass(n.invisible),Header.el.centerSection.empty().append(Header.el.icon),Anim.slideFromLeft()},u=function(t,e){e?t.classList.add(n.hide):t.classList.remove(n.hide)},m=function(t){var e=$("<div/>").addClass("loader");return t.append(e),e},f=function(){for(var t=0,e=document.querySelectorAll(".link-wrap"),n=0;n<e.length;n++)t+=e[n].offsetHeight;var a=document.body.offsetHeight,i=$$.q("header").offsetHeight,r=$$.q(".loader"),s=r?r.offsetHeight:0,o=a-i-s;t>o?$("#main-overflow").css("min-height",""):$("#main-overflow").css("min-height",o-t+1)},p="undefined"!=typeof window.orientation,v=function(){return window.pageYOffset||"CSS1Compat"===document.compatMode&&document.documentElement.scrollTop||document.body.scrollTop||0},h=function(){p&&(document.body.style.height=screen.height+"px",setTimeout(function(){window.scrollTo(0,1);var t=v();window.scrollTo(0,1===t?0:1),document.body.style.height=window.innerHeight+"px"},1))},g=function(){var t="36px"===$(".menu-desc").css("height")?"35px":"36px";setTimeout(function(){$(".menu-desc").css("height",t)},500)},b=function(){if(window.applicationCache&&window.applicationCache.addEventListener("updateready",function(){var e=1;Menu.isShowing()&&(Menu.move(t.LEFT),e=301),setTimeout(function(){r.mainWrap.prepend("<button class='btn blck mrgn-cntr-x mrgn-y' id='btn-update' onclick='window.location.reload();'>Reeddit updated. Press to reload</button>")},e)},!1),window.addEventListener("resizeend",function(){is.wideScreen=wideScreenBP.matches,is.largeScreen=largeScreenBP.matches,h(),is.largeScreen&&Menu.isShowing()&&Menu.move(t.LEFT),is.iPad&&g()},!1),is.iPhone&&is.iOS7){var i=!1;document.addEventListener("touchstart",function(t){var e=t.targetTouches[0].clientX;i=e<20||e>window.innerWidth-20}),document.addEventListener("touchend",function(){i=!1})}window.addEventListener("hashchange",function(){is.iPhone&&is.iOS7&&(i?(r.mainView.addClass(n.swipe),r.detailView.addClass(n.swipe),Header.el.btnNavBack.addClass(n.swipe),Header.el.subtitle.addClass(n.swipe)):(r.mainView.removeClass(n.swipe),r.detailView.removeClass(n.swipe),Header.el.btnNavBack.removeClass(n.swipe),Header.el.subtitle.removeClass(n.swipe)),i=!1),""===location.hash?(c(),Posts.clearSelected(),Footer.setPostTitle(),setTimeout(function(){r.detailWrap.empty()},is.wideScreen?1:301)):Comments.navigateFromHash()},!1),UI.el.body.on("click",".js-btn-refresh",function(t){t.preventDefault();var n=this.dataset.origin;switch(n){case"footer-main":Posts.refreshStream();break;case"footer-detail":if(!Comments.getCurrentThread())return;Comments.show(Comments.getCurrentThread(),!0);break;default:if(s===e.COMMENTS){if(!Comments.getCurrentThread())return;Comments.show(Comments.getCurrentThread(),!0)}s===e.MAIN&&Posts.refreshStream()}}),r.body.on("click",".close-form",function(t){t.preventDefault(),Modal.remove()}),r.body.on("click",".close-thread",function(t){t.preventDefault(),$(".detail-view").removeClass("show-view"),$(".main-view").addClass("show-view")}),is.mobile&&(is.iPhone&&is.iOS7||r.detailView.swipeRight(function(){is.wideScreen||(location.hash="#")}),r.mainView.swipeRight(function(){!is.desktop&&Posts.areLoading()||is.largeScreen||s===e.MAIN&&Menu.move(t.RIGHT)}),r.mainView.swipeLeft(function(){!is.desktop&&Posts.areLoading()||is.largeScreen||Menu.isShowing()&&Menu.move(t.LEFT)}),r.mainView.on("swipeLeft",".link",function(){if(!is.wideScreen&&!Menu.isShowing()){var t=$(this).data("id");Comments.updateHash(t)}})),r.body.on("keydown",function(n){if(!Modal.isShowing())switch(n.which){case a.MENU:if(!is.largeScreen){if(o()!==e.MAIN)return;Menu.move(t.RIGHT)}Menu.el.mainMenu.focus();break;case a.MAIN:is.largeScreen||(o()===e.MAIN?Menu.move(t.LEFT):window.location.hash=""),r.mainWrap.focus();break;case a.DETAIL:if(!is.largeScreen&&o()===e.MAIN)return;r.detailWrap.focus()}})};return{el:r,classes:n,View:e,Move:t,template:i,initListeners:b,setCurrentView:d,getCurrentView:o,setSubTitle:l,scrollTop:h,iPadScrollFix:g,scrollFixLinks:f,addLoader:m,backToMainView:c,switchDisplay:u}}(),Backup=function(){var t=1,e={buttonExportData:$("#exp-data"),buttonImportData:$("#imp-data")},n={exportData:"\n\t\t<div class='new-form move-data'>\n\t\t\t"+UI.template.closeModalButton+'\n\t\t\t<div class=\'move-data-exp\'>\n\t\t\t\t<h3>Export Data</h3>\n\t\t\t\t<p>You can back-up your local subscriptions and then import them to any other Reeddit instance, or just restore them.</p>\n\t\t\t\t<a class="btn no-ndrln txt-cntr blck w-100 mrgn-y pad-y"\n\t\t\t\t   id="btn-download-data"\n\t\t\t\t   download="reedditdata.json">Download Data</a>\n\t\t\t</div>\n\t\t</div>',importData:"\n\t\t<div class='new-form move-data'>\n\t\t\t"+UI.template.closeModalButton+"\n\t\t\t<div class='move-data-imp'>\n\t\t\t\t<h3>Import Data</h3>\n\t\t\t\t<p>Load the subscriptions from another Reeddit instance.</p>\n\t\t\t\t<p>Once you choose the reeddit data file, Reeddit will refresh with the imported data.</p>\n\t\t\t\t<button class='btn w-100 mrgn-y pad-y'\n\t\t\t\t\t\t    id='btn-trigger-file'>Choose Backup file</button>\n\t\t\t\t<input id='file-chooser'\n\t\t\t\t\t\t\t class=\"hide\"\n\t\t\t\t\t     type=\"file\" />\n\t\t\t</div>\n\t\t</div>"},a=function(){t=1},i=function(){return'{"channels": '+Store.getItem("channels")+', "subreddits": '+Store.getItem("subreeddits")+"}"},r=function(t){$$.id("btn-download-data")},s=function(){t&&Modal.show(n.exportData,function(){r(i())})},o=function(t){var e=!1;"string"==typeof t&&(t=JSON.parse(t)),t.subreddits&&Store.setItem("subreeddits",JSON.stringify(t.subreddits)),t.discards&&Store.setItem("discards",JSON.stringify(t.discards)),t.archives&&Store.setItem("archives",JSON.stringify(t.archives)),t.comments&&Store.setItem("comments",JSON.stringify(t.comments)),e=!0,e&&window.location.reload()},d=function(){e.buttonExportData.on("click",function(t){t.preventDefault(),s()}),e.buttonImportData.on("click",function(t){t.preventDefault(),Modal.show(n.importData,function(){is.iOS&&(UI.switchDisplay($$.id("btn-trigger-file"),!0),UI.switchDisplay($$.id("file-chooser"),!1))})}),UI.el.body.on("change","#file-chooser",function(t){var e={locateFile:function(t){return"https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.5.0/dist/"+t}},n=t.target.files[0],a=new FileReader;a.onload=function(){var t=new Uint8Array(a.result);initSqlJs(e).then(function(e){var n=new e.Database(t);console.log(n),console.log("Database loaded from file successfully");var a=n.exec("SELECT * FROM subreddits"),i=n.exec("SELECT * FROM discards"),r=n.exec("SELECT * FROM archives"),s=n.exec("SELECT * FROM comments");console.log(a,i,r,s);var d=[];if(a.length>0)for(var l=0;l<a[0].values.length;l++)d.push({subreddit:a[0].values[l][0],regex:a[0].values[l][1]});var c=[];if(s.length>0)for(var u=0;u<s[0].values.length;u++)c.push({id:s[0].values[u][0],count:s[0].values[u][1],subreddit:s[0].values[u][2]});var m=[];if(i.length>0)for(var f=0;f<i[0].values.length;f++)m.push(i[0].values[f][0]);var p=[];if(r.length>0)for(var v=0;v<r[0].values.length;v++)p.push(r[0].values[v][0]);o({subreddits:d,discards:m,archives:p,comments:c})})},a.readAsArrayBuffer(n)}),UI.el.body.on("click","#btn-trigger-file",function(){$$.id("file-chooser").click()}),UI.el.body.on("click","#btn-download-data",function(){var t=window.initSqlJs,e=function(){return new Promise(function(e,n){t({locateFile:function(t){return"https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.3.0/dist/"+t}}).then(function(t){var n=Store.getItem("subreeddits"),a=Store.getItem("discards"),i=Store.getItem("archives"),r=Store.getItem("archives_comments");n&&(n=JSON.parse(n));var s=new t.Database;s.run("CREATE TABLE subreddits(subreddit text, regex text);"),s.run("CREATE TABLE discards(id text);"),s.run("CREATE TABLE archives(id text);"),s.run("CREATE TABLE comments(id text, count text, subreddit text);");for(var o=0;o<n.length;o++){var d=s.exec("SELECT * FROM subreddits WHERE subreddit='"+n[o].subreddit+"';");0==d.length&&s.run("INSERT INTO subreddits VALUES ('"+n[o].subreddit+"', '"+n[o].regex+"');")}if(a){a=JSON.parse(a);for(var l=0;l<a.length;l++)s.run("INSERT INTO discards VALUES ('"+a[l]+"');")}if(i){i=JSON.parse(i);for(var c=0;c<i.length;c++)s.run("INSERT INTO archives VALUES ('"+i[c]+"');")}if(r){r=JSON.parse(r);for(var u=0;u<r.length;u++)s.run("INSERT INTO comments VALUES ('"+r[u].id+"', '"+r[u].comments+"', '"+r[u].subreddit+"');")}e(s)})["catch"](function(t){n(t)})})};e().then(function(t){var e=t["export"]();window.localStorage.setItem("dbBackup",JSON.stringify([].concat(_toConsumableArray(e))));var n=JSON.parse(window.localStorage.getItem("dbBackup")),a=new Blob([new Uint8Array(n)],{type:"application/octet-stream"}),i=URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download="db.sqlite",r.click(),console.log("Database downloaded successfully")})["catch"](function(t){console.error("Error initializing database:",t)})})};return{initListeners:d,shouldUpdate:a}}(),Channels=function(){var t={name:"Media",subs:["movies","television","music","games","books"]},e='<a href="#{{name}}" class="channel pad-x no-ndrln blck" data-title="{{name}}"><div class="channel__title">{{name}}</div><div class="pad-x">{{#subs}}<div class="channel__sub txt-cap txt-ellps">{{.}}</div>{{/subs}}</div></a>',n='<button class="w-100" id="btn-add-another-sub">Add additional subreddit</button>',a={singleEditItem:"<div class='item-to-edit flx channel-to-remove' data-title='{{name}}'><p class='sub-name w-85 txt-cap txt-bld channel-name'>{{name}}</p><a href='#edit' class='flx flx-cntr-x flx-cntr-y w-15 no-ndrln clr-current btn-edit-channel icon-pencil' data-title='{{name}}'></a><a href='#remove' class='flx flx-cntr-x flx-cntr-y w-15 no-ndrln clr-current btn-remove-channel icon-trashcan' data-title='{{name}}'></a></div>",single:e,list:"{{#.}}"+e+"{{/.}}",formAddNew:'<div class="new-form" id="form-new-channel"><div class="form-left-corner"><button class="btn" id="btn-submit-channel" data-op="save">Add Channel</button></div>'+UI.template.closeModalButton+'<input type="text" id="txt-channel" placeholder="Channel name" /><div id="subs-for-channel"><input class="field-edit-sub" type="text" placeholder="Subreddit 1" /><input class="field-edit-sub" type="text" placeholder="Subreddit 2" /><input class="field-edit-sub" type="text" placeholder="Subreddit 3" /></div>'+n+"</div>",formEditChannel:'<div class="new-form" id="form-new-channel"><div class="form-left-corner"><button class="btn" id="btn-submit-channel" data-op="update">Update Channel</button></div>'+UI.template.closeModalButton+'<input type="text" id="txt-channel" placeholder="Channel name" /><div id="subs-for-channel"></div>'+n+"</div>"},i=[],r="",s={menu:$("#channels")},o=function(){return i},d=function(t){return 1===t.subs.length?"r/"+t.subs[0]+"+"+t.subs[0]:"r/"+t.subs.join("+")},l=function(t){i.push(t),Store.setItem("channels",JSON.stringify(i)),Backup.shouldUpdate()},c=function(t){for(var e=0;e<i.length;e++)if(i[e].name===t){i.splice(e,1);break}Store.setItem("channels",JSON.stringify(i)),Backup.shouldUpdate()},u=function(t){for(var e,n=0;n<i.length;n++)if(i[n].name.toLowerCase()===t.toLowerCase()){e=i[n];break}return e},m=function(t){s.menu.append(Mustache.to_html(a.single,t)),Subreddits.isEditing()&&v(t.name)},f=function(){s.menu.html(Mustache.to_html(a.list,i))},p=function(t){var e=$('.channel-to-remove[data-title="'+t+'"]');e.addClass("anim-delete"),setTimeout(function(){e.remove()},200),$('.channel[data-title="'+t+'"]').remove()},v=function(t){$(".channel-edit-list").append(a.singleEditItem.replace(/\{\{name\}\}/g,t))},h=function(t,e){var n={name:t,subs:e};l(n),m(n)},g=function(){i=Store.getItem("channels"),i=i?JSON.parse(i):[t],f()},b=function(t){Posts.load(URLs.init+d(t)+"/"),UI.setSubTitle(t.name),CurrentSelection.setChannel(t)},w=function(t){c(t),p(t),CurrentSelection.getType()===CurrentSelection.Types.CHANNEL&&CurrentSelection.getName()===t&&CurrentSelection.setSubreddit("frontPage")},S=function(t){var e=u(t);Modal.show(a.formEditChannel,function(){$("#txt-channel").val(e.name),r=e.name;var t=$("#subs-for-channel");e.subs.map(function(e){var n="<input class='field-edit-sub with-clear' type='text' value='"+e+"'>";t.append(n)})})},x=function(){UI.el.body.on("click","#btn-submit-channel",function(t){var e=t.target,n=$("#txt-channel"),a=e.getAttribute("data-op"),i=n.val();if(!i)return n.attr("placeholder","Enter a Channel name!"),void Anim.shakeForm();for(var s=[],o=$("#subs-for-channel input"),d=0;d<o.length;d++){var l=$(o[d]).val();l&&s.push(l)}if(0===s.length)return o[0].placeholder="Enter at least one subreddit!",void Anim.shakeForm();switch(a){case"save":var c=u(i);if(c)return n.val(""),n.attr("placeholder","'"+i+"' already exists."),void Anim.shakeForm();h(i,s);break;case"update":w(r),h(i,s)}$(e).remove(),$(".form-left-corner").append("<div class='clr-white txt-bld channel-added-msg'>'"+i+"' "+a+"d. Cool!</div>"),Anim.bounceOut($(".new-form"),Modal.remove)}),UI.el.mainWrap.on("click","#btn-add-channel",function(){Modal.show(a.formAddNew)}),UI.el.mainWrap.on("click",".btn-remove-channel",function(t){t.preventDefault(),w(this.dataset.title)}),UI.el.mainWrap.on("click",".btn-edit-channel",function(t){t.preventDefault(),S(this.dataset.title)})};return{getList:o,getByName:u,getURL:d,loadPosts:b,loadSaved:g,initListeners:x,template:{formAddNew:a.formAddNew,singleEditItem:a.singleEditItem}}}(),Comments=function(){var t,e=!1,n={},a=function(t){e=t},i=function(){return t},r=function(t){location.hash="#comments:"+t},s=function(){var t=location.hash.match(/(#comments:)((?:[a-zA-Z0-9]*))/);if(t&&t[2])return t[2]},o=function(){var t=s();c(t),is.wideScreen&&Posts.markSelected(t)},d=function(t){e=!1;var n="Error loading comments. Refresh to try again.";is.wideScreen?t.addClass("loader-error").html(n+'<button class="btn mrgn-cntr-x mrgn-y blck w-33 js-btn-refresh">Refresh</button>'):t.addClass("loader-error").text(n),is.desktop||UI.el.detailWrap.append($("<section/>"))},l=function(e,a,i){for(var r=(new Date).getTime(),s=new Markdown.Converter,o=$("<div/>").addClass("comments-level"),d=0;d<e.length;d++){var l=e[d];if("t1"===l.kind){var c=s.makeHtml(l.data.body),u=Posts.getList()[t].author===l.data.author,m=URLs.init+Posts.getList()[t].link+l.data.id,f={href:m,target:"_blank",title:"See this comment on reddit.com",tabindex:"-1"},p=$("<div/>").addClass("comment-wrap").attr("tabindex","0").append($("<div/>").append($("<div/>").addClass("comment-data").append($("<span/>").addClass(u?"comment-poster":"comment-author").text(l.data.author)).append($("<a/>").addClass("comment-info no-ndrln").attr(f).text(timeSince(r,l.data.created_utc)))).append($("<div/>").addClass("comment-body").html(c)));l.data.replies&&"more"!==l.data.replies.data.children[0].kind&&(p.append($("<button/>").addClass("btn blck comments-button js-reply-button").attr("data-comment-id",l.data.id).text("See replies ("+l.data.replies.data.children.length+")")),n[l.data.id]=l.data.replies.data.children),o.append(p)}}a.append(o),i&&(Posts.getLoaded()[i]=o);for(var v=UI.el.detailWrap.find("a"),h=0;h<v.length;h++){var g=v[h],b=$(g).attr("href");null!=b.match(/\.(jpeg|jpg|gif|png)/)&&($(g).attr("class")||(console.log($(g)),$(g).html('<img class="video-preview" \n\t\t\t\t\tsrc="'+b+'"/>')))}UI.el.detailWrap.find("a").attr("target","_blank")},c=function(n,a){if(Posts.getList()[n]){var i=0;Menu.isShowing()&&(Menu.move(UI.Move.LEFT),i=301),setTimeout(function(){if(!e||!t||t!==n){e=!0,t=n,Header.el.btnNavBack.removeClass(UI.classes.invisible);var i=UI.el.detailWrap;if(i.empty(),UI.el.detailWrap[0].scrollTop=0,Posts.getLoaded()[n]&&!a)i.append(Posts.getList()[n].summary),$("#comments-container").append(Posts.getLoaded()[n]),LinkSummary.updatePostSummary(Posts.getList()[n],n),e=!1;else{LinkSummary.setPostSummary(Posts.getList()[n],n);var r=URLs.init+Posts.getList()[n].link+URLs.end,s=UI.addLoader(i);$.ajax({dataType:"jsonp",url:r,success:function(a){t===n&&(LinkSummary.updatePostSummary(a[0].data.children[0].data,n),s.remove(),l(a[1].data.children,$("#comments-container"),n),e=!1)},error:function(){d(s)}})}u(n,a)}},i)}else{t=n;var r=UI.addLoader(UI.el.detailWrap);e=!0,$.ajax({dataType:"jsonp",url:URLs.init+"comments/"+n+"/"+URLs.end,success:function(t){r.remove(),e=!1,Posts.setList(t[0].data),LinkSummary.setPostSummary(t[0].data.children[0].data,n),Header.el.btnNavBack.removeClass(UI.classes.invisible),u(n,a),l(t[1].data.children,$("#comments-container"),n)},error:function(){d(r)}})}},u=function(t,e){var n=Posts.getList()[t].title,a=0;e||Footer.setPostTitle(n),e||UI.getCurrentView()===UI.View.COMMENTS||(Anim.slideFromRight(),a=301),Header.el.centerSection.empty().append(Header.el.postTitle),Header.el.postTitle.text(n),Header.el.subtitle.addClass(UI.classes.invisible),is.wideScreen||setTimeout(function(){UI.el.detailWrap.focus()},a)},m=function(){UI.el.detailWrap.on("click","#comments-container a, #selftext a",function(t){var e=LinkSummary.checkImageLink(this.href);e&&(t.preventDefault(),Modal.showImageViewer(e))}),UI.el.detailWrap.on("click",".js-reply-button",function(){var t=$(this),e=t.attr("data-comment-id"),a=n[e];l(a,t.parent()),is.iOS&&($(".comment-active").removeClass("comment-active"),t.parent().addClass("comment-active")),t.remove()})};return{initListeners:m,navigateFromHash:o,getCurrentThread:i,show:c,updateHash:r,setLoading:a,getIdFromHash:s}}(),CurrentSelection=function(){var t="",e="",n={SUB:1,CHANNEL:2},a="currentSelection",i=function(){return t},r=function(){return e},s=function(n,i){t=n,e=i,Store.setItem(a,JSON.stringify({name:t,type:e}))},o=function(){var i=Store.getItem(a);i&&(i=JSON.parse(i)),t=i?i.name:"frontPage",e=i?i.type:n.SUB},d=function(t){s(t,n.SUB)},l=function(t){s(t.name,n.CHANNEL)},c=function(t,a){switch(e){case n.SUB:t();break;case n.CHANNEL:a()}};return{getName:i,getType:r,Types:n,loadSaved:o,setSubreddit:d,setChannel:l,execute:c}}(),Footer=function(){var t="",e="No Post Selected",n={detail:$("#detail-footer"),postTitle:$("#footer-post"),subTitle:$("#footer-sub"),getRefreshButton:function(){return t||(t=document.querySelector("#main-footer .footer-refresh")),t}},a=function(t){n.postTitle.text(t?t:e);var a=n.detail.find(".btn-footer");t?a.removeClass(UI.classes.hide):a.addClass(UI.classes.hide)};return{el:n,setPostTitle:a}}(),Header=function(){var t={subtitle:$("#main-title"),subtitleText:$("#sub-title"),centerSection:$("#title-head"),postTitle:$("#title"),icon:$("#header-icon"),btnNavBack:$("#nav-back")},e=function(){t.subtitleText.on("click",function(){is.mobile&&Posts.areLoading()||Menu.move(Menu.isShowing()?UI.Move.LEFT:UI.Move.RIGHT)})};return{el:t,initListeners:e}}(),LinkSummary=function(){var t="\n\t\t<section id='link-summary'>\n\t\t\t"+UI.template.closeThreadButton+"\n\t\t\t<a href='{{url}}' style='max-width:97%;'\n\t\t\t   target='_blank'\n\t\t\t   class='no-ndrln'>\n\t\t\t\t<span id='summary-title'\n\t\t\t\t\t  class='pad-x txt-bld blck'>{{title}}</span>\n\t\t\t\t<span id='summary-domain'\n\t\t\t\t\t  class='pad-x txt-bld'>{{domain}}</span>\n\t\t\t\t{{#over_18}}\n\t\t\t\t<span class='link-label txt-bld summary-label nsfw'>NSFW</span>\n\t\t\t\t{{/over_18}}\n\t\t\t\t{{#stickied}}\n\t\t\t\t<span class='link-label txt-bld summary-label stickied'>Stickied</span>\n\t\t\t\t{{/stickied}}\n\t\t\t</a>\n\t\t\t<div id='summary-footer'>\n\t\t\t\t<span id='summary-author'\n\t\t\t\t\t  class='pad-x txt-bld'>by {{author}}</span>\n\t\t\t</div>\n\t\t\t<div id='summary-preview'>\n\t\t\t</div>\n\t\t\t<div id='summary-btn'>\n\t\t\t\t<a class='btn mrgn-x no-ndrln save-tw'\n\t\t\t\t\t  id='share-tw'\n\t\t\t\t\t  rid='{{name}}'\n\t\t\t\t\t  href='#'>Save</a>\n\t\t\t\t<a class='btn mrgn-x no-ndrln'\n\t\t\t\t   id='share-tw'\n\t\t\t\t   target='_blank'\n\t\t\t\t   href='https://twitter.com/intent/tweet?text=\"{{encodedTitle}}\" —&url={{url}}&via=ReedditApp&related=ReedditApp'>Tweet</a>\n\t\t\t\t<a class='btn mrgn-x no-ndrln discard-tw'\n\t\t\t\t   id='discard-tw'\n\t\t\t\t   rid='{{name}}'\n\t\t\t\t   href='#'>Discard</a>\n\t\t\t</div>\n\t\t\t<div class='ls-extra flx flx-spc-btwn-x txt-bld'>\n\t\t\t\t<span class='w-33'\n\t\t\t\t\t  id='summary-sub'>{{subreddit}}</span>\n\t\t\t\t<span class='w-33 txt-cntr'\n\t\t\t\t\t  id='summary-time'></span>\n\t\t\t\t<a class='w-33 no-ndrln txt-r clr-current'\n\t\t\t\t   id='summary-comment-num'\n\t\t\t\t   title='See comments on reddit.com'\n\t\t\t\t   href='http://reddit.com{{link}}'\n\t\t\t\t   target='_blank'>{{num_comments}} comments</a>\n\t\t\t</div>\n\t\t</section>",e=function(e,n){e.link||(e.link=e.permalink);var d=Mustache.to_html(t,e);if(e.selftext){var l;if(Posts.getList()[n].selftextParsed)l=Posts.getList()[n].selftext;else{var c=new Markdown.Converter;l=c.makeHtml(e.selftext),Posts.getList()[n].selftext=l,Posts.getList()[n].selftextParsed=!0}var u="&amp;#x200B;",m=" ",f=new RegExp(u,"g"),p=l.replace(f,m);d+="<section id='selftext' class='pad-x mrgn-x mrgn-y'>"+p+"</section>"}var v=Posts.getList()[n].url,h="";Posts.getList()[n].preview&&(h=Posts.getList()[n].preview.images[0].source.url);var g=i(h),b=Posts.getList()[n].is_gallery,w=Posts.getList()[n].gallery_data,S=Posts.getList()[n].media_metadata,x=Posts.getList()[n].domain;if(console.log(Posts.getList()[n],"check"),v){var y=r(v);if(y)d+='<a class="video-preview-btn preview-container blck" \n\t\t\t\t\t\t\t\thref="#" data-id="'+y+'">\n\t\t\t\t\t\t <img class="video-preview" \n\t\t\t\t\t\t      src="//img.youtube.com/vi/'+y+'/hqdefault.jpg"/>\n\t\t\t\t\t\t </a>\n\t\t\t\t\t\t <div class="video-preview-box"></div>';else if("v.redd.it"==x)d+='<div style="text-align:center;"><video id="redditVideo" style="width=100%" src="'+Posts.getList()[n].media.reddit_video.fallback_url+'" controls></video></div>';else if(b){d+='<div class="wrapper_gallery">';for(var I=0;I<w.items.length;I++)d+='\n\t\t\t\t\t\t<div class="card_gallery">\n\t\t\t\t\t\t\t<a href="#preview" target="_blank" class="preview-container blck js-gallery-preview" data-img="'+S[w.items[I].media_id].s.u+'">\n\t\t\t\t\t\t\t<img src="'+S[w.items[I].media_id].p[0].u+'" class="cover_gallery image-preview" alt="">\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>';d+="</div>"}else if(g)d+='<a href="#preview" class="preview-container blck js-img-preview" data-img="'+g+'"><img class="image-preview" src="'+g+'" height=500 /></a>';else{var C=s(v),U=o(v);C?d+="<div style='position:relative; padding-bottom:56.69%'><iframe src='https://gfycat.com/ifr/"+C+"' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>":U&&(d+="<div style='position:relative; padding-bottom:56.69%'><iframe src='https://redgifs.com/ifr/"+U+"' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>")}}d+="<section id='comments-container'></section>",UI.el.detailWrap.append(d),a(e.created_utc),Posts.getList()[n].summary=d,Footer.el.postTitle.text(e.title)},n=function(t,e){$("#summary-comment-num").text(t.num_comments+(1===t.num_comments?" comment":" comments")),a(t.created_utc),Posts.getList()[e].num_comments=t.num_comments,Posts.getList()[e].created_utc=t.created_utc},a=function(t){$("#summary-time").text(timeSince((new Date).getTime(),t))},i=function(t){var e=t.match(/\.(svg|jpe?g|png|gifv?)(?:[?#].*)?$|(?:imgur\.com|livememe\.com|reddituploads\.com)\/([^?#\/.]*)(?:[?#].*)?(?:\/)?$/);return e?e[1]?(t.indexOf(".gifv")>0&&(t=t.replace(".gifv",".gif")),t.indexOf("imgur.com")>=0&&(t=t.replace(/^htt(p|ps):/,"")),t):e[2]?"imgur"===e[0].slice(0,5)?"//imgur.com/"+e[2]+".jpg":e[0].indexOf("livememe.")>=0?"http://i.lvme.me/"+e[2]+".jpg":e[0].indexOf("reddituploads.")>=0?e.input:null:null:""},r=function(t){var e=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return e?11===e[2].length?e[2]:null:""},s=function(t){var e=t.match(/gfycat.com\/(gifs\/detail\/)?(\w+)/i);return e?e&&e.length>2?e[2]:null:""},o=function(t){var e=t.match(/redgifs.com\/(?:(?:ifr|watch)\/)(\w+)/i);return e?e&&e.length>1?e[1]:null:""},d=function(){UI.el.detailWrap.on("click",".js-img-preview",function(t){t.preventDefault(),Modal.showImageViewer(this.dataset.img)}),UI.el.detailWrap.on("click",".js-gallery-preview",function(t){t.preventDefault();for(var e=$(this).parent().parent().children(),n=[],a=0;a<e.length;a++){var i=e[a];n.push($(i).find("a").attr("data-img"))}console.log(n),Modal.showGalleryViewer(n)}),UI.el.detailWrap.on("click",".discard-tw",function(t){t.preventDefault();var e=$(this).attr("rid");console.log(e),$("#"+e).css("display","none");var n=localStorage.getItem("discards");n?(n=JSON.parse(n),n.indexOf(e)==-1&&n.push(e),localStorage.setItem("discards",JSON.stringify(n))):localStorage.setItem("discards",JSON.stringify([e]))}),UI.el.detailWrap.on("click",".save-tw",function(t){t.preventDefault();var e=$(this).attr("rid");console.log(e);var n=localStorage.getItem("archives"),a=localStorage.getItem("archives_comments"),i=localStorage.getItem("currentSelection");i=JSON.parse(i),n?(n=JSON.parse(n),a=JSON.parse(a),n.indexOf(document.getElementById(e).outerHTML)==-1&&(n.push(document.getElementById(e).outerHTML),a.push({id:e,subreddit:i.name,comments:$("#summary-comment-num").text()})),localStorage.setItem("archives",JSON.stringify(n)),localStorage.setItem("archives_comments",JSON.stringify(a))):(localStorage.setItem("archives",JSON.stringify([document.getElementById(e).outerHTML])),localStorage.setItem("archives_comments",JSON.stringify([{id:e,subreddit:i.name,comments:$("#summary-comment-num").text()}])))}),UI.el.detailWrap.on("click",".video-preview-btn",function(t){t.preventDefault(),$(this).css("display","none"),$(this).parent().find(".video-preview-box").html('<iframe \n\t\t\t\t\twidth="560" \n\t\t\t\t\theight="315" \n\t\t\t\t\tsrc="https://www.youtube.com/embed/'+$(this).attr("data-id")+'?controls=1&autoplay=0" \n\t\t\t\t\ttitle="YouTube video player" \n\t\t\t\t\tframeborder="0" \n\t\t\t\t\tstyle="display: block;margin: 0px auto;"\n\t\t\t\t\tallow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" \n\t\t\t\t\tallowfullscreen>\n\t\t\t\t</iframe>')})};return{setPostSummary:e,updatePostSummary:n,checkImageLink:i,initListeners:d}}(),Menu=function(){var t={mainMenu:$("#main-menu"),buttonNewSubreddit:$("#btn-new-sub"),buttonNewChannel:$("#btn-new-channel"),buttonAddSubreddits:$("#btn-add-subs"),buttonEditSubreddits:$("#btn-edit-subs"),buttonAbout:$("#about")},e=!1,n=function(){return e},a={about:"<div class='new-form about-reeddit'>"+UI.template.closeModalButton+"<ul><li><a href='/about/' target='_blank'>Reeddit Homepage</a></li><li><a href='https://github.com/berbaquero/reeddit' target='_blank'>GitHub Project</a></li></ul><p><a href='https://twitter.com/reedditapp'>@ReedditApp</a></p><p>Built by <a href='http://berbaquero.com' target='_blank'>Bernardo Baquero Stand</a></p></div>"},i="sub--selected",r="channel--selected",s=function(t){is.iPhone&&is.iOS7&&(UI.el.mainView.removeClass(UI.classes.swipe),UI.el.detailView.removeClass(UI.classes.swipe)),t===UI.Move.LEFT&&(UI.el.mainView.removeClass(UI.classes.showMenu),setTimeout(function(){e=!1},1)),t===UI.Move.RIGHT&&(UI.el.mainView.addClass(UI.classes.showMenu),setTimeout(function(){e=!0},1))},o=function(t){var e=t.type,n=t.el,a=t.name,s=t.update;s&&d();var o=e&&"channel"===e;if(n)return void n.classList.add(o?r:i);if(a){var l=o?'.channel[data-title="'+a+'"]':'.sub[data-name="'+a+'"]',c=document.querySelector(l);c.classList.add(o?r:i)}},d=function(){$(".sub.sub--selected").removeClass(i),$(".channel.channel--selected").removeClass(r)},l=function(){t.mainMenu.on("click",".channel",function(t){t.preventDefault();var e=this,n=e.getAttribute("data-title");Menu.move(UI.Move.LEFT),(n!==CurrentSelection.getName()||Subreddits.isEditing())&&(Menu.markSelected({type:"channel",el:e,update:!0}),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView(),Channels.loadPosts(Channels.getByName(n)))}),t.mainMenu.on("click",".sub",function(t){t.preventDefault(),$(".sub--selected").removeClass("sub--selected");var e=t.target;Menu.move(UI.Move.LEFT),Subreddits.loadPosts(e.dataset.name),o({el:e,update:!0}),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView()}),t.buttonNewSubreddit.on("click",function(t){t.preventDefault(),Modal.show(Subreddits.template.formInsert)}),t.buttonNewChannel.on("click",function(t){t.preventDefault(),Modal.show(Channels.template.formAddNew)}),t.buttonAddSubreddits.on("click",function(t){t.preventDefault(),Subreddits.loadForAdding()}),t.buttonEditSubreddits.on("click",function(t){t.preventDefault(),Subreddits.loadForEditing()}),t.buttonAbout.on("click",function(t){t.preventDefault(),Modal.show(a.about)})};return{isShowing:n,initListeners:l,move:s,markSelected:o,cleanSelected:d,el:t}}(),Modal=function(){function t(){var t=$("#imgs"),e=$("#imgs").find("img");console.log(c,"check",e),c>e.length-1?c=0:c<0&&(c=e.length-1),t.css("transform","translateX("+-c*u+"px)")}var e=!1,n=function(t){e=t},a=function(){return e},i=function(t,e,i){var r=1;!is.largeScreen&&Menu.isShowing()&&(Menu.move(UI.Move.LEFT),r=301),setTimeout(function(){if(!a()){var r=$("<div/>").attr({id:"modal",tabindex:"0","class":"modal"}),s=!0;i&&(i.modalClass&&r.addClass(i.modalClass),i.noBounce&&(s=!1)),r.append(t),UI.el.body.append(r),r.focus(),l(!0),n(!0),setTimeout(function(){r.css("opacity",1),s&&Anim.bounceInDown($(".new-form"))},1),e&&e()}},r)},r=function(){var t=$("#modal");t.css("opacity",""),n(!1),setTimeout(function(){t.remove(),l(!1)},301)},s=function(t){var e='<img class="image-viewer centered-transform" src="'+t+'">',n={modalClass:"modal--closable",noBounce:!0};Modal.show(e,!1,n)},o=function(t){console.log(t);for(var e='<div style="align-items: center;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\tmargin: 0;"><div class="carousel">\n\t\t\t\t<div class="buttons-container">\n\t\t\t\t<button id="left" class="gallery_btn">Prev</button>\n\t\t\t\t<button id="right" class="gallery_btn">Next</button>\n\t\t\t\t</div>\n\t\t\t<div class="image-container" id="imgs" style="">',n=0;n<t.length;n++)e+='<img\n\t\t\t\tsrc="'+t[n]+'"\n\t\t\t\talt="second-image"\n\t\t\t\tstyle="object-fit: cover; width:300px;"\n\t\t\t/>';e+="</div>\n\t\t\t</div></div>";var a={modalClass:"modal--closable",noBounce:!0};Modal.show(e,!1,a)},d=function(t){27===t.which&&r()},l=function(t){t?UI.el.body.on("keydown",d):UI.el.body.off("keydown",d)},c=0,u=300,m=function(){c+=-1,t()},f=function(){c+=1,t()},p=function(){UI.el.body.on("click",".modal--closable",function(t){console.log(t.target.className),"gallery_btn"!=t.target.className&&Modal.remove()}),UI.el.body.on("click","#left",m),UI.el.body.on("click","#right",f)};return{show:i,remove:r,showImageViewer:s,showGalleryViewer:o,initListeners:p,isShowing:a}}(),Posts=function(){var t="\n\t\t{{#children}}\n\t\t\t<article class='link-wrap flx w-100' id='{{data.name}}'>\n\t\t\t\t<div class='link flx no-ndrln pad-y pad-x js-link' data-id='{{data.id}}'>\n\t\t\t\t\t<div class='link-thumb'>\n\t\t\t\t\t\t<div style='background-image: url({{data.thumbnail}})'></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='link-info'>\n\t\t\t\t\t\t<p\n\t\t\t\t\t\t   data-id='{{data.id}}'\n\t\t\t\t\t\t   class='link-title no-ndrln blck js-post-title'>\n\t\t\t\t\t\t{{data.title}}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<div class='link-domain'>{{data.domain}}</div>\n\t\t\t\t\t\t<span class='link-sub'>{{data.subreddit}}</span>\n\t\t\t\t\t\t{{#data.over_18}}\n\t\t\t\t\t\t<span class='link-label txt-bld nsfw'>NSFW</span>\n\t\t\t\t\t\t{{/data.over_18}}\n\t\t\t\t\t\t{{#data.stickied}}\n\t\t\t\t\t\t<span class='link-label txt-bld stickied'>Stickied</span>\n\t\t\t\t\t\t{{/data.stickied}}\n\t\t\t\t\t\t<p class=\"tagline \">\n\t\t\t\t\t\t\tsubmitted \n\t\t\t\t\t\t\t<time title=\"{{data.unix_time}}\" class=\"live-timestamp\">\n\t\t\t\t\t\t\t\t{{data.time_ago}} ({{data.timestamp}})\n\t\t\t\t\t\t\t</time> by \n\t\t\t\t\t\t\t<a href=\"https://old.reddit.com/user/slvrfn\" class=\"author may-blank id-t2_o61cy\">\n\t\t\t\t\t\t\t{{data.author}}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<span class=\"userattrs\"></span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p class=\"tagline \">\n\t\t\t\t\t\t\t<a href=\"{{data.url}}\" data-event-action=\"comments\" class=\"bylink comments may-blank\" rel=\"nofollow\">{{data.comments}}</a>\n\t\t\t\t\t\t\t<a href=\"#\">save</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<a href='#comments:{{data.id}}' class='to-comments w-15 flx flx-cntr-y btn-basic'>\n\t\t\t\t\t<div class='comments-icon'></div>\n\t\t\t\t</a>\n\t\t\t</article>\n\t\t{{/children}}\n\t\t<button id='btn-load-more-posts'\n\t\t\t\tclass='btn blck mrgn-cntr-x'>More</button>\n\t\t<div id='main-overflow'></div>",e=!1,n={},a={},i="",r={
moreButton:function(){return $("#btn-load-more-posts")}},s=function(){return n},o=function(){return a},d=function(t){e=t},l=function(){return e},c=function(t,e){var a=n[e];a.self||is.wideScreen?Comments.updateHash(e):w(t)},u=function(t,n,a){if(!e){e=!0,Comments.setLoading(!1),Subreddits.setEditing(!1);var i=UI.el.mainWrap;n?(r.moreButton().remove(),i.append(UI.template.loader)):(UI.el.mainWrap[0].scrollTop=0,setTimeout(function(){i.prepend(UI.template.loader)},Menu.isShowing()?301:1),n=""),$.ajax({dataType:"jsonp",url:t+Sorting.get()+URLs.limitEnd+n,success:function(t){if(console.log(a,"check"),a)if(a.length>1){for(var e=t,i=t.data.children,r=0;r<a.length;r++){var s=new RegExp(a[r],"i"),o=i.filter(function(t){return s.test(t.data.title)});console.log(o,a[r]),i=o}e.data.children=i,p(e,n)}else{var s=new RegExp(a,"i"),e=t;e.data.children=t.data.children.filter(function(t){return s.test(t.data.title)}),p(e,n)}else p(t,n)},error:function(){e=!1,$(".loader").addClass("loader-error").text("Error loading links. Refresh to try again.")}})}},m=function(t){p(t),UI.el.mainWrap[0].scrollTop=0,Subreddits.setEditing(!1)},f=function(e,n){var a=e,i=[],r=Store.getItem("comments");r&&(r=JSON.parse(r));for(var s=0;s<e.children.length;s++){var o=e.children[s],d="";r&&(d=r.filter(function(t){return t.id===e.children[s].data.name}),d.length>0&&(d=" ("+d[0].count.split(" ")[0]+")")),Object.assign(o.data,{time_ago:x(e.children[s].data.created_utc),unix_time:y(e.children[s].data.created_utc),timestamp:I(e.children[s].data.created_utc),comments:1==e.children[s].data.num_comments?"comment"+d:e.children[s].data.num_comments+" comments"+d}),i.push(o)}a.children=i;var l=e.children.length,c=UI.el.mainWrap;if(n?$(".loader").remove():is.desktop?c.empty():c.empty().removeClass("anim-reveal").addClass(UI.classes.invisible),0===l){var u=$(".loader");u?(u.text("No Links available.").addClass("loader-error"),c.append('<div id="#main-overflow"></div>')):c.prepend('<div class="loader loader-error">No Links available.</div><div id="main-overflow"></div>')}else{var m=Mustache.to_html(t,a),f=m.replace(/url\(http\:/g,"url(");c.append(f);for(var p=$(".link-thumb > div"),v=0;v<p.length;v++){var h=$(p[v]),g=h.attr("style").replace("background-image: ","");"url()"!==g&&"url(default)"!==g&&"url(nsfw)"!==g&&"url(image)"!==g&&"url(spoiler)"!==g&&"url(self)"!==g||("url(self)"===g?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -444px"):"url(default)"===g?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -225px"):"url(spoiler)"===g?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -371px"):"url(image)"===g?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -152px"):"url(nsfw)"===g&&(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -298px"))}var b=localStorage.getItem("discards");if(b){b=JSON.parse(b);for(var w=0;w<b.length;w++)$("#"+b[w]).css("display","none")}}is.desktop||UI.scrollFixLinks(),n||Anim.reveal(c),is.largeScreen||UI.el.mainWrap.focus()},p=function(t,n){var a=t.data;if(e=!1,i=a.after,v(a),f(a,n),is.wideScreen){var r=Comments.getIdFromHash();r&&g(r)}},v=function(t){for(var e=0;e<t.children.length;e++){var a=t.children[e];n[a.data.id]?(n[a.data.id].num_comments=a.data.num_comments,n[a.data.id].created_utc=a.data.created_utc):n[a.data.id]={title:a.data.title,encodedTitle:encodeURI(a.data.title),selftext:a.data.selftext,created_utc:a.data.created_utc,domain:a.data.domain,name:a.data.name,subreddit:a.data.subreddit,num_comments:a.data.num_comments,url:a.data.url,self:a.data.is_self,link:a.data.permalink,author:a.data.author,preview:a.data.preview,is_gallery:a.data.is_gallery,media:a.data.media,media_metadata:a.data.media_metadata,gallery_data:a.data.gallery_data,over_18:a.data.over_18,stickied:a.data.stickied}}},h=function(){if(!Subreddits.isEditing()){var t=localStorage.getItem("currentSelection");t=JSON.parse(t);var e=localStorage.getItem("subreeddits"),n="",a="";if(e&&(e=JSON.parse(e),n=e.filter(function(e){return e.subreddit.toLowerCase()===t.name.toLowerCase()}),n.length>0))if("frontpage"===t.name.toLowerCase()){for(var i=[],r=0;r<e.length;r++)i.push(e[r].regex);a=i}else a=[n[0].regex];CurrentSelection.execute(function(){"frontpage"===CurrentSelection.getName().toLowerCase()?u(URLs.init+"r/"+Subreddits.getAllSubsString()+"/","",a):u(URLs.init+"r/"+CurrentSelection.getName()+"/","",a)},function(){Channels.loadPosts(Channels.getByName(CurrentSelection.getName()))})}},g=function(t){$(".link.link-selected").removeClass("link-selected"),$('.link[data-id="'+t+'"]').addClass("link-selected")},b=function(){$(".link.link-selected").removeClass("link-selected")},w=function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank");var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});e.dispatchEvent(n)},S=function(){UI.el.mainWrap.on("click",".js-link",function(t){is.wideScreen&&Comments.updateHash(this.dataset.id)}),UI.el.mainWrap.on("click",".js-post-title",function(t){t.preventDefault();var e=t.target.dataset.id,n=t.target.href;c(n,e)}),UI.el.mainWrap.on("click","#btn-load-more-posts",function(){CurrentSelection.execute(function(){var t;t="frontpage"===CurrentSelection.getName().toLowerCase()?URLs.init+"r/"+Subreddits.getAllSubsString()+"/":URLs.init+"r/"+CurrentSelection.getName()+"/",u(t,"&after="+i)},function(){var t=Channels.getByName(CurrentSelection.getName());u(URLs.init+Channels.getURL(t)+"/","&after="+i)})})},x=function(t){var e=(new Date).getTime(),n=e-1e3*t,a=Math.floor(n/1e3);return a<60?"Just now":a/60<60?Math.floor(a/60)+" minutes ago":a/3600<24?Math.floor(a/3600)+" hours ago":Math.floor(a/86400)+" days ago"},y=function(t){var e=new Date(1e3*t),n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=n[e.getUTCDay()]+" "+a[e.getUTCMonth()]+" "+String(e.getUTCDate()).padStart(2,"0")+" "+String(e.getUTCHours()).padStart(2,"0")+":"+String(e.getUTCMinutes()).padStart(2,"0")+":"+String(e.getUTCSeconds()).padStart(2,"0")+" "+e.getUTCFullYear()+" UTC";return i},I=function(t){var e=new Date(1e3*t),n=e.getUTCFullYear(),a=e.getUTCMonth()+1,i=e.getUTCDate(),r=e.getUTCHours(),s=e.getUTCMinutes(),o=e.getUTCSeconds(),d=r+":"+s+":"+o+" "+n+"-"+a+"-"+i;return d};return{initListeners:S,load:u,clearSelected:b,refreshStream:h,markSelected:g,loadFromManualInput:m,setLoading:d,areLoading:l,getList:s,setList:v,timeAgo:x,unixTime:y,timestamp:I,getLoaded:o}}(),SortSwitch=function(){var t=!0,e={"new":"sort-switch--new"},n="",a={getWrap:function(){return n||(n=document.getElementsByClassName("sorter-wrap")[0]),n},mainSwitch:$(".js-sort-switch-main")},i=function(){a.mainSwitch.on("click",function(n){n.preventDefault();var a=this;Posts.areLoading()||(t=!t,Sorting.change(t?"hot":"new"),t?a.classList.remove(e["new"]):a.classList.add(e["new"]))})};return{el:a,initListeners:i}}(),Sorting=function(){var t="hot",e=function(){return"hot"!==t?t+"/":""},n=function(e){t=e;var n=1;Menu.isShowing()&&(Menu.move(UI.Move.LEFT),n=301),setTimeout(function(){Posts.refreshStream()},n)};return{get:e,change:n}}(),Subreddits=function(){var t,e=[{subreddit:"frontPage",regex:"f"},{subreddit:"all",regex:"a"},{subreddit:"pics",regex:"p"},{subreddit:"tech",regex:"t"},{subreddit:"cryptocurrencies",regex:"crypto"}],n=[],a="",i=!1,r="sub pad-x pad-y blck no-ndrln txt-cap txt-ellps",s={list:"{{#.}}<a href='#{{subreddit}}' data-name='{{subreddit}}' class='"+r+"'>{{subreddit}}</a>{{/.}}",toEditList:"<div class='edit-subs-title pad-x pad-y txt-bld txt-cntr'>Subreddits</div><ul class='no-mrgn no-pad'>{{#.}}<div class='item-to-edit flx sub-to-remove' data-name='{{subreddit}}'><p class='sub-name w-85 txt-cap txt-bld'>{{subreddit}} (regex: {{regex}})</p><a href='#edit_sub' rid='{{subreddit}}' class='flx flx-cntr-x flx-cntr-y w-15 no-ndrln clr-current btn-edit-sub icon-pencil'></a><a href='#remove' class='no-ndrln clr-current flx flx-cntr-x flx-cntr-y w-15 btn-remove-sub icon-trashcan' data-name='{{subreddit}}'></a></div>{{/.}}</ul>",toAddList:"{{#children}}<div class='sub-to-add flx w-100'><div class='w-85'><p class='sub-to-add__title js-sub-title txt-bld'>{{data.display_name}}</p><p class='sub-to-add__description'>{{data.public_description}}</p></div><a href='#add' class='btn-add-sub no-ndrln flx flx-cntr-x flx-cntr-y w-15 icon-plus-circle'></a></div>{{/children}}",loadMoreSubsButton:"<button class='btn blck w-50 mrgn-y mrgn-cntr-x' id='btn-more-subs'>More</button>",formInsert:'<div class="new-form" id="form-new-sub"><div class="form-left-corner"><button class="btn" id="btn-add-new-sub">Add Subreddit</button></div>'+UI.template.closeModalButton+'<form><input type="text" id="txt-new-sub" placeholder="New subreddit name" /><input type="text" id="txt-new-reg" placeholder="Regex" style="margin-top: 10px;" /></form></div>',formUpdate:'<div class="new-form" id="form-update-sub"><div class="form-left-corner"><button class="btn" id="btn-update-new-sub">Update Subreddit</button></div>'+UI.template.closeModalButton+'<form><input type="text" id="txt-update-sub" placeholder="Subreddit name" /><input type="text" id="txt-update-reg" placeholder="Regex" style="margin-top: 10px;" /></form></div>',topButtonsForAdding:"<div class='flx flx-cntr-x pad-x pad-y'><button id='btn-sub-man' class='btn group-btn'>Insert Manually</button><button id='btn-add-channel' class='btn group-btn'>Create Channel</button></div>"},o={list:$("#subs")},d=function(){return n},l=function(){return i},c=function(t,e){n.push({subreddit:t,regex:e}),Store.setItem("subreeddits",JSON.stringify(n)),Backup.shouldUpdate()},u=function(t){var e=n.findIndex(function(e){return e.subreddit===t});n.splice(e,1),Store.setItem("subreeddits",JSON.stringify(n)),Backup.shouldUpdate()},m=function(t){t instanceof Array?o.list.append(Mustache.to_html(s.list,t)):o.list.append($("<a/>").attr({"data-name":t,href:"#"}).addClass(r).text(t));var e=localStorage.getItem("archives_comments"),n=[],a="";if(e){e=JSON.parse(e);for(var i=0;i<e.length;i++){var d=e[i].subreddit.charAt(0).toUpperCase()+e[i].subreddit.slice(1);n.indexOf(d)==-1&&(n.push(d),a+="<a href='#' class='cSub pad-x pad-y blck no-ndrln txt-cap txt-ellps' rid='"+e[i].subreddit+"'>"+d+"</a>")}}$("#archive_subs").html(a)},f=function(t){var e=$(".sub-to-remove[data-name='"+t+"']");e.addClass("anim-delete"),setTimeout(function(){e.remove()},200),o.list.find(".sub[data-name="+t+"]").remove()},p=function(t){n=t,Store.setItem("subreeddits",JSON.stringify(n)),Backup.shouldUpdate()},v=function(t){if(n){t=t.toLowerCase();for(var e=n.length;--e;){var a=n[e].subreddit;if(a.toLowerCase()===t)return!0}return!1}return!1},h=function(){for(var t="",e="frontpage",a="all",i=0;i<n.length;i++){var r=n[i].subreddit.toLowerCase();r!==e&&r!==a&&(t+=r+"+")}return t.substring(0,t.length-1)},g=function(t){var e=Store.getItem("subreeddits");e&&(e=JSON.parse(e)),n=e,n||p(t),m(n)},b=function(t){var e=n.filter(function(e){return e.subreddit.toLowerCase()===t.toLowerCase()});console.log(t,"checking--",e,i);var a;if(a="frontpage"===t.toLowerCase()?URLs.init+"r/"+h()+"/":URLs.init+"r/"+t+"/",e.length>0)if("frontpage"===t.toLowerCase()){for(var r=[],s=0;s<n.length;s++)r.push(n[s].regex);Posts.load(a,"",r)}else Posts.load(a,"",[e[0].regex]);else Posts.load(a,"","");CurrentSelection.setSubreddit(t),UI.setSubTitle(t)},w=function(t){u(t),f(t),CurrentSelection.getType()===CurrentSelection.Types.SUB&&CurrentSelection.getName()===t&&CurrentSelection.setSubreddit(e[0].subreddit)},S=function(t,e){v(t)||(c(t,e),m(t))},x=function(t,e){var n=localStorage.getItem("update_sub");u(n),f(n),c(t,e),m(t),localStorage.removeItem("update_sub")},y=function(){var t=$$.id("txt-new-sub"),e=t.value,n=$("#txt-new-reg").val();return e?v(e)?(t.value="",t.setAttribute("placeholder",e+" already added!"),void Anim.shakeForm()):(e=e.trim(),Anim.bounceOut($(".new-form"),Modal.remove),void $.ajax({url:URLs.init+"r/"+e+"/"+Sorting.get()+URLs.limitEnd,dataType:"jsonp",success:function(t){if(n){var a=new RegExp(n,"i"),i=t;i.data.children=t.data.children.filter(function(t){return a.test(t.data.title)}),Posts.loadFromManualInput(i)}else Posts.loadFromManualInput(t);UI.setSubTitle(e),CurrentSelection.setSubreddit(e),S(e,n),Menu.markSelected({name:e,update:!0})},error:function(){alert("Oh, the subreddit you entered is not valid...")}})):(t.setAttribute("placeholder","Enter a subreddit title!"),void Anim.shakeForm())},I=function(){var t=$$.id("txt-update-sub"),e=t.value,n=$("#txt-update-reg").val();return e?(e=e.trim(),Anim.bounceOut($(".new-form"),Modal.remove),void $.ajax({url:URLs.init+"r/"+e+"/"+Sorting.get()+URLs.limitEnd,dataType:"jsonp",success:function(t){if(n){var a=new RegExp(n,"i"),i=t;i.data.children=t.data.children.filter(function(t){return a.test(t.data.title)}),Posts.loadFromManualInput(i)}else Posts.loadFromManualInput(t);UI.setSubTitle(e),CurrentSelection.setSubreddit(e),x(e,n),Menu.markSelected({name:e,update:!0})},error:function(){alert("Oh, the subreddit you entered is not valid...")}})):(t.setAttribute("placeholder","Enter a subreddit title!"),void Anim.shakeForm())},C=function(t){t!==i&&(i=t,is.wideScreen&&(UI.switchDisplay(Footer.el.getRefreshButton(),t),UI.switchDisplay(SortSwitch.el.getWrap(),t)))},U=function(){is.largeScreen||Menu.move(UI.Move.LEFT),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView(),setTimeout(function(){UI.el.mainWrap[0].scrollTop=0;var e=UI.el.mainWrap;t?e.empty().append(s.topButtonsForAdding).append(t).append(s.loadMoreSubsButton):(e.prepend(UI.template.loader).prepend(s.topButtonsForAdding),$.ajax({url:URLs.init+"reddits/.json?limit=50&jsonp=?",dataType:"jsonp",success:function(n){a=n.data.after,t=Mustache.to_html(s.toAddList,n.data),e.empty().append(s.topButtonsForAdding).append(t).append(s.loadMoreSubsButton)},error:function(){$(".loader").addClass("loader-error").text("Error loading subreddits.")}})),Posts.setLoading(!1)},is.largeScreen?1:301),Menu.cleanSelected(),UI.setSubTitle("Add Subs"),C(!0)},k=function(){is.largeScreen||Menu.move(UI.Move.LEFT),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView(),setTimeout(function(){UI.el.mainWrap[0].scrollTop=0;var t=Mustache.to_html(s.toEditList,n),e="",a=Channels.getList();a&&a.length>0&&(e=Mustache.to_html("<div class='edit-subs-title pad-x pad-y txt-bld txt-cntr'>Channels</div><ul class='no-mrgn no-pad channel-edit-list'>{{#.}} "+Channels.template.singleEditItem+"{{/.}}</ul>",a));var i='<div class="h-100">'+e+t+"</div>";setTimeout(function(){UI.el.mainWrap.html(i)},10),Menu.cleanSelected(),Posts.setLoading(!1)},is.largeScreen?1:301),UI.setSubTitle("Edit Subs"),C(!0)},L=function(){UI.el.body.on("submit","#form-new-sub form",function(t){t.preventDefault(),y()}),UI.el.body.on("submit","#form-update-sub form",function(t){t.preventDefault(),I()}),UI.el.body.on("click","#btn-add-new-sub",y),UI.el.body.on("click","#btn-update-new-sub",I),UI.el.body.on("click",".cSub",function(){var t=$(this).attr("rid");$(".sub--selected").removeClass("sub--selected"),$(this).addClass("sub--selected");var e=localStorage.getItem("archives_comments");if(e){e=JSON.parse(e);var n=e.filter(function(e){return e.subreddit.toLowerCase()===t.toLowerCase()});console.log(n);var a=localStorage.getItem("archives"),i="";if(a){a=JSON.parse(a);for(var r=0;r<n.length;r++)for(var s=0;s<a.length;s++){var o=a[s];o.indexOf(n[r].id)>-1&&(o=o.replace("link-selected",""),i+=o)}}$("#main-wrap").html(i)}}),UI.el.body.on("click","#btn-add-another-sub",function(){var t=$("#subs-for-channel");t.append("<input type='text' placeholder='Extra subreddit'/>"),t[0].scrollTop=t.height()}),UI.el.mainWrap.on("click","#btn-sub-man",function(){Modal.show(s.formInsert)}),UI.el.mainWrap.on("click",".link-wrap",function(){$(".main-view").removeClass("show-view"),$(".detail-view").addClass("show-view")}),UI.el.mainWrap.on("click",".btn-edit-sub",function(){var t=$(this).attr("rid"),e=n.filter(function(e){return e.subreddit.toLowerCase()===t.toLowerCase()}),a=e[0].regex;Modal.show(s.formUpdate),setTimeout(function(){localStorage.setItem("update_sub",t),$("#txt-update-sub").val(t),$("#txt-update-reg").val(a)},500)}),UI.el.mainWrap.on("click","#btn-more-subs",function(e){var n=e.target;$(n).remove();var i=UI.el.mainWrap;i.append(UI.template.loader),$.ajax({url:URLs.init+"reddits/"+URLs.end+"&after="+a,dataType:"jsonp",success:function(e){var n=Mustache.to_html(s.toAddList,e.data);a=e.data.after,$(".loader",i).remove(),i.append(n).append(s.loadMoreSubsButton),t+=n},error:function(){$(".loader").addClass("loader-error").text("Error loading more subreddits.")}})}),UI.el.mainWrap.on("click",".btn-add-sub",function(t){t.preventDefault();var e=$(this).parent(),n=$(".js-sub-title",e);n.css("color","#2b9900");var a=n.text();S(a,"")}),UI.el.mainWrap.on("click",".btn-remove-sub",function(t){t.preventDefault(),w(this.dataset.name)})};return{getList:d,getAllSubsString:h,setEditing:C,isEditing:l,loadPosts:b,loadForEditing:k,loadForAdding:U,loadSaved:g,initListeners:L,template:{formInsert:s.formInsert}}}(),Anim=function(){var t=function(){var t=UI.classes.showView;UI.el.mainView.addClass(t),UI.el.detailView.removeClass(t),UI.setCurrentView(UI.View.MAIN)},e=function(){var t=UI.classes.showView;UI.el.mainView.removeClass(t),UI.el.detailView.addClass(t),UI.setCurrentView(UI.View.COMMENTS)},n=function o(t){var o="anim-reveal";is.desktop?(t.addClass(o),setTimeout(function(){t.removeClass(o)},700)):setTimeout(function(){t.removeClass(UI.classes.invisible).addClass(o)},0)},a=function d(t){var d="anim-shake";t.addClass(d),setTimeout(function(){t.removeClass(d)},350)},i=function(){a($(".new-form"))},r=function l(t,e){var l="anim-bounce-out";t.addClass(l),e&&setTimeout(e,1e3)},s=function(t){t.addClass("anim-bounceInDown"),setTimeout(function(){t[0].style.opacity=1,t.removeClass("anim-bounceInDown")},500)};return{slideFromLeft:t,slideFromRight:e,reveal:n,shake:a,shakeForm:i,bounceOut:r,bounceInDown:s}}(),$$={id:function(t){return document.getElementById(t)},q:function(t){return document.querySelector(t)}},wideScreenBP=window.matchMedia("(min-width: 1000px)"),largeScreenBP=window.matchMedia("(min-width: 490px)"),UA=window.navigator.userAgent,is=function(){var t=!/iPhone|iPod|iPad|Android|Mobile/.test(UA),e=/iPad/.test(UA),n=/iP(hone|od)/.test(UA),a=n||e,i=function(){return a?parseInt(UA.match(/ OS (\d+)_/i)[1],10):0}();return{wideScreen:wideScreenBP.matches,largeScreen:largeScreenBP.matches,desktop:t,mobile:!t,iPhone:n,iPad:e,iOS:a,iOS7:a&&i>=7}}(),Store=window.fluid?allCookies:window.localStorage,ThemeSwitcher=function(){var t=["classic","light","dark"],e=0,n={switcherButton:$("#switch-theme")},a=function(){var t=s(),e=o();UI.el.body.removeClass(t),i(e)},i=function(t){UI.el.body.addClass(t),r(t),d(t)},r=function(t){n.switcherButton.text("Theme: "+t)},s=function(){return t[e]},o=function(){return e++,e===t.length&&(e=0),t[e]},d=function(t){Store.setItem("theme",t)},l=function(){return Store.getItem("theme")},c=function(){var n=l();n?u(n):i(is.iOS7?t[1]:t[e])},u=function(n){s()!==n&&(i(n),e=t.indexOf(n))},m=function(){c(),n.switcherButton.on("click",function(t){t.preventDefault(),a()})};return{init:m}}(),URLs={init:"https://www.reddit.com/",end:".json?jsonp=?",limitEnd:".json?limit=30&jsonp=?"};UI.initListeners(),Posts.initListeners(),Comments.initListeners(),Subreddits.initListeners(),Channels.initListeners(),Menu.initListeners(),Header.initListeners(),Modal.initListeners(),SortSwitch.initListeners(),Backup.initListeners(),LinkSummary.initListeners(),Header.el.postTitle.remove(),is.wideScreen&&Footer.el.postTitle.text(""),CurrentSelection.loadSaved();var initDefaults=[{subreddit:"frontPage",regex:"f"},{subreddit:"all",regex:"a"},{subreddit:"pics",regex:"p"},{subreddit:"tech",regex:"t"},{subreddit:"cryptocurrencies",regex:"crypto"}],defaults=[],initSqlJs=window.initSqlJs,DB_NAME="reddit_db",initDb=function(){return new Promise(function(t,e){initSqlJs({locateFile:function(t){return"https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.3.0/dist/"+t}}).then(function(e){var n=new e.Database;n.run("CREATE TABLE subreddits(subreddit text, regex text);"),n.run("CREATE TABLE threads(id text);");for(var a=0;a<initDefaults.length;a++){var i=n.exec("SELECT * FROM subreddits WHERE subreddit='"+initDefaults[a].subreddit+"';");0==i.length&&n.run("INSERT INTO subreddits VALUES ('"+initDefaults[a].subreddit+"', '"+initDefaults[a].regex+"');")}n.run("INSERT INTO threads VALUES ('testid');");var r=n.exec("SELECT * FROM subreddits;");if(r.length>0)for(var s=0;s<r[0].values.length;s++)defaults.push({subreddit:r[0].values[s][0],regex:r[0].values[s][1]});t(n)})["catch"](function(t){e(t)})})};initDb().then(function(t){if(console.log("Database initialization successful."),Subreddits.loadSaved(defaults),console.log(defaults),Channels.loadSaved(),location.hash&&Comments.navigateFromHash(),CurrentSelection.execute(function(){var t=CurrentSelection.getName();Menu.markSelected({name:t});var e=localStorage.getItem("subreeddits"),n="",a="";if(e&&(e=JSON.parse(e),n=e.filter(function(e){return e.subreddit.toLowerCase()===t.toLowerCase()}),n.length>0))if("frontpage"===t.toLowerCase()){for(var i=[],r=0;r<e.length;r++)i.push(e[r].regex);a=i}else a=[n[0].regex];t.toUpperCase()==="frontPage".toUpperCase()?(CurrentSelection.setSubreddit("frontPage"),Posts.load(URLs.init+"r/"+Subreddits.getAllSubsString()+"/","",a)):Posts.load(URLs.init+"r/"+t+"/","",a),UI.setSubTitle(t)},function(){var t=Channels.getByName(CurrentSelection.getName());Menu.markSelected({type:"channel",name:t.name}),Channels.loadPosts(t)}),ThemeSwitcher.init(),is.mobile){UI.scrollTop();var e="touchmove";$$.id("edit-subs").addEventListener(e,function(t){t.preventDefault()},!1),document.getElementsByTagName("header")[0].addEventListener(e,function(t){Menu.isShowing()&&t.preventDefault()},!1),is.iPad&&UI.iPadScrollFix(),is.iOS7&&document.body.classList.add("ios7")}FastClick.attach(document.body)})["catch"](function(t){console.error("Error initializing database:",t)});