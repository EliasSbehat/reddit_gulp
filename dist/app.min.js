"use strict";var UI=function(){var t={LEFT:1,RIGHT:2},e={MAIN:1,COMMENTS:2},n={showView:"show-view",showMenu:"show-menu",mnml:"mnml",hide:"hide",swipe:"from-swipe",invisible:"invisible"},a={MENU:49,MAIN:50,DETAIL:51},i={loader:"<div class='loader'></div>",closeModalButton:"<a href='#close' class='close-form no-ndrln txt-cntr txt-bld'>&times;</a>"},o={body:$("body"),mainWrap:$("#main-wrap"),detailWrap:$("#detail-wrap"),mainView:$(".main-view"),detailView:$(".detail-view")},s=e.MAIN,r=function(){return s},d=function(t){s=t},l=function(t){Header.el.subtitleText.text(t),Footer.el.subTitle.text(t)},c=function(){Header.el.btnNavBack.addClass(n.invisible),Header.el.subtitle.removeClass(n.invisible),Header.el.centerSection.empty().append(Header.el.icon),Anim.slideFromLeft()},u=function(t,e){e?t.classList.add(n.hide):t.classList.remove(n.hide)},m=function(t){var e=$("<div/>").addClass("loader");return t.append(e),e},p=function(){for(var t=0,e=document.querySelectorAll(".link-wrap"),n=0;n<e.length;n++)t+=e[n].offsetHeight;var a=document.body.offsetHeight,i=$$.q("header").offsetHeight,o=$$.q(".loader"),s=o?o.offsetHeight:0,r=a-i-s;t>r?$("#main-overflow").css("min-height",""):$("#main-overflow").css("min-height",r-t+1)},f="undefined"!=typeof window.orientation,h=function(){return window.pageYOffset||"CSS1Compat"===document.compatMode&&document.documentElement.scrollTop||document.body.scrollTop||0},b=function(){f&&(document.body.style.height=screen.height+"px",setTimeout(function(){window.scrollTo(0,1);var t=h();window.scrollTo(0,1===t?0:1),document.body.style.height=window.innerHeight+"px"},1))},v=function(){var t="36px"===$(".menu-desc").css("height")?"35px":"36px";setTimeout(function(){$(".menu-desc").css("height",t)},500)},g=function(){if(window.applicationCache&&window.applicationCache.addEventListener("updateready",function(){var e=1;Menu.isShowing()&&(Menu.move(t.LEFT),e=301),setTimeout(function(){o.mainWrap.prepend("<button class='btn blck mrgn-cntr-x mrgn-y' id='btn-update' onclick='window.location.reload();'>Reeddit updated. Press to reload</button>")},e)},!1),window.addEventListener("resizeend",function(){is.wideScreen=wideScreenBP.matches,is.largeScreen=largeScreenBP.matches,b(),is.largeScreen&&Menu.isShowing()&&Menu.move(t.LEFT),is.iPad&&v()},!1),is.iPhone&&is.iOS7){var i=!1;document.addEventListener("touchstart",function(t){var e=t.targetTouches[0].clientX;i=e<20||e>window.innerWidth-20}),document.addEventListener("touchend",function(){i=!1})}window.addEventListener("hashchange",function(){is.iPhone&&is.iOS7&&(i?(o.mainView.addClass(n.swipe),o.detailView.addClass(n.swipe),Header.el.btnNavBack.addClass(n.swipe),Header.el.subtitle.addClass(n.swipe)):(o.mainView.removeClass(n.swipe),o.detailView.removeClass(n.swipe),Header.el.btnNavBack.removeClass(n.swipe),Header.el.subtitle.removeClass(n.swipe)),i=!1),""===location.hash?(c(),Posts.clearSelected(),Footer.setPostTitle(),setTimeout(function(){o.detailWrap.empty()},is.wideScreen?1:301)):Comments.navigateFromHash()},!1),UI.el.body.on("click",".js-btn-refresh",function(t){t.preventDefault();var n=this.dataset.origin;switch(n){case"footer-main":Posts.refreshStream();break;case"footer-detail":if(!Comments.getCurrentThread())return;Comments.show(Comments.getCurrentThread(),!0);break;default:if(s===e.COMMENTS){if(!Comments.getCurrentThread())return;Comments.show(Comments.getCurrentThread(),!0)}s===e.MAIN&&Posts.refreshStream()}}),o.body.on("click",".close-form",function(t){t.preventDefault(),Modal.remove()}),is.mobile&&(is.iPhone&&is.iOS7||o.detailView.swipeRight(function(){is.wideScreen||(location.hash="#")}),o.mainView.swipeRight(function(){!is.desktop&&Posts.areLoading()||is.largeScreen||s===e.MAIN&&Menu.move(t.RIGHT)}),o.mainView.swipeLeft(function(){!is.desktop&&Posts.areLoading()||is.largeScreen||Menu.isShowing()&&Menu.move(t.LEFT)}),o.mainView.on("swipeLeft",".link",function(){if(!is.wideScreen&&!Menu.isShowing()){var t=$(this).data("id");Comments.updateHash(t)}})),o.body.on("keydown",function(n){if(!Modal.isShowing())switch(n.which){case a.MENU:if(!is.largeScreen){if(r()!==e.MAIN)return;Menu.move(t.RIGHT)}Menu.el.mainMenu.focus();break;case a.MAIN:is.largeScreen||(r()===e.MAIN?Menu.move(t.LEFT):window.location.hash=""),o.mainWrap.focus();break;case a.DETAIL:if(!is.largeScreen&&r()===e.MAIN)return;o.detailWrap.focus()}})};return{el:o,classes:n,View:e,Move:t,template:i,initListeners:g,setCurrentView:d,getCurrentView:r,setSubTitle:l,scrollTop:b,iPadScrollFix:v,scrollFixLinks:p,addLoader:m,backToMainView:c,switchDisplay:u}}(),Backup=function(){var t=1,e={buttonExportData:$("#exp-data"),buttonImportData:$("#imp-data")},n={exportData:"\n\t\t<div class='new-form move-data'>\n\t\t\t"+UI.template.closeModalButton+'\n\t\t\t<div class=\'move-data-exp\'>\n\t\t\t\t<h3>Export Data</h3>\n\t\t\t\t<p>You can back-up your local subscriptions and then import them to any other Reeddit instance, or just restore them.</p>\n\t\t\t\t<a class="btn no-ndrln txt-cntr blck w-100 mrgn-y pad-y"\n\t\t\t\t   id="btn-download-data"\n\t\t\t\t   download="reedditdata.json">Download Data</a>\n\t\t\t</div>\n\t\t</div>',importData:"\n\t\t<div class='new-form move-data'>\n\t\t\t"+UI.template.closeModalButton+"\n\t\t\t<div class='move-data-imp'>\n\t\t\t\t<h3>Import Data</h3>\n\t\t\t\t<p>Load the subscriptions from another Reeddit instance.</p>\n\t\t\t\t<p>Once you choose the reeddit data file, Reeddit will refresh with the imported data.</p>\n\t\t\t\t<button class='btn w-100 mrgn-y pad-y'\n\t\t\t\t\t\t    id='btn-trigger-file'>Choose Backup file</button>\n\t\t\t\t<input id='file-chooser'\n\t\t\t\t\t\t\t class=\"hide\"\n\t\t\t\t\t     type=\"file\"\n\t\t\t\t\t     accept=\"application/json\"/>\n\t\t\t</div>\n\t\t</div>"},a=function(){t=1},i=function(){return'{"channels": '+Store.getItem("channels")+', "subreddits": '+Store.getItem("subreeddits")+"}"},o=function(t){var e=$$.id("btn-download-data");e.href="data:text/json;charset=utf-8,"+encodeURIComponent(t)},s=function(){t&&Modal.show(n.exportData,function(){o(i())})},r=function(t){var e=!1;"string"==typeof t&&(t=JSON.parse(t)),t.subreddits&&(e=!0,Store.setItem("subreeddits",JSON.stringify(t.subreddits))),t.channels&&(e=!0,Store.setItem("channels",JSON.stringify(t.channels))),e&&window.location.reload()},d=function(t){var e=new FileReader;e.onload=function(){r(e.result)},e.readAsText(t)},l=function(){e.buttonExportData.on("click",function(t){t.preventDefault(),s()}),e.buttonImportData.on("click",function(t){t.preventDefault(),Modal.show(n.importData,function(){is.iOS&&(UI.switchDisplay($$.id("btn-trigger-file"),!0),UI.switchDisplay($$.id("file-chooser"),!1))})}),UI.el.body.on("change","#file-chooser",function(){var t=this.files[0];d(t)}),UI.el.body.on("click","#btn-trigger-file",function(){$$.id("file-chooser").click()})};return{initListeners:l,shouldUpdate:a}}(),Channels=function(){var t={name:"Media",subs:["movies","television","music","games","books"]},e='<a href="#{{name}}" class="channel pad-x no-ndrln blck" data-title="{{name}}"><div class="channel__title">{{name}}</div><div class="pad-x">{{#subs}}<div class="channel__sub txt-cap txt-ellps">{{.}}</div>{{/subs}}</div></a>',n='<button class="w-100" id="btn-add-another-sub">Add additional subreddit</button>',a={singleEditItem:"<div class='item-to-edit flx channel-to-remove' data-title='{{name}}'><p class='sub-name w-85 txt-cap txt-bld channel-name'>{{name}}</p><a href='#edit' class='flx flx-cntr-x flx-cntr-y w-15 no-ndrln clr-current btn-edit-channel icon-pencil' data-title='{{name}}'></a><a href='#remove' class='flx flx-cntr-x flx-cntr-y w-15 no-ndrln clr-current btn-remove-channel icon-trashcan' data-title='{{name}}'></a></div>",single:e,list:"{{#.}}"+e+"{{/.}}",formAddNew:'<div class="new-form" id="form-new-channel"><div class="form-left-corner"><button class="btn" id="btn-submit-channel" data-op="save">Add Channel</button></div>'+UI.template.closeModalButton+'<input type="text" id="txt-channel" placeholder="Channel name" /><div id="subs-for-channel"><input class="field-edit-sub" type="text" placeholder="Subreddit 1" /><input class="field-edit-sub" type="text" placeholder="Subreddit 2" /><input class="field-edit-sub" type="text" placeholder="Subreddit 3" /></div>'+n+"</div>",formEditChannel:'<div class="new-form" id="form-new-channel"><div class="form-left-corner"><button class="btn" id="btn-submit-channel" data-op="update">Update Channel</button></div>'+UI.template.closeModalButton+'<input type="text" id="txt-channel" placeholder="Channel name" /><div id="subs-for-channel"></div>'+n+"</div>"},i=[],o="",s={menu:$("#channels")},r=function(){return i},d=function(t){return 1===t.subs.length?"r/"+t.subs[0]+"+"+t.subs[0]:"r/"+t.subs.join("+")},l=function(t){i.push(t),Store.setItem("channels",JSON.stringify(i)),Backup.shouldUpdate()},c=function(t){for(var e=0;e<i.length;e++)if(i[e].name===t){i.splice(e,1);break}Store.setItem("channels",JSON.stringify(i)),Backup.shouldUpdate()},u=function(t){for(var e,n=0;n<i.length;n++)if(i[n].name.toLowerCase()===t.toLowerCase()){e=i[n];break}return e},m=function(t){s.menu.append(Mustache.to_html(a.single,t)),Subreddits.isEditing()&&h(t.name)},p=function(){s.menu.html(Mustache.to_html(a.list,i))},f=function(t){var e=$('.channel-to-remove[data-title="'+t+'"]');e.addClass("anim-delete"),setTimeout(function(){e.remove()},200),$('.channel[data-title="'+t+'"]').remove()},h=function(t){$(".channel-edit-list").append(a.singleEditItem.replace(/\{\{name\}\}/g,t))},b=function(t,e){var n={name:t,subs:e};l(n),m(n)},v=function(){i=Store.getItem("channels"),i=i?JSON.parse(i):[t],p()},g=function(t){Posts.load(URLs.init+d(t)+"/"),UI.setSubTitle(t.name),CurrentSelection.setChannel(t)},w=function(t){c(t),f(t),CurrentSelection.getType()===CurrentSelection.Types.CHANNEL&&CurrentSelection.getName()===t&&CurrentSelection.setSubreddit("frontPage")},S=function(t){var e=u(t);Modal.show(a.formEditChannel,function(){$("#txt-channel").val(e.name),o=e.name;var t=$("#subs-for-channel");e.subs.map(function(e){var n="<input class='field-edit-sub with-clear' type='text' value='"+e+"'>";t.append(n)})})},x=function(){UI.el.body.on("click","#btn-submit-channel",function(t){var e=t.target,n=$("#txt-channel"),a=e.getAttribute("data-op"),i=n.val();if(!i)return n.attr("placeholder","Enter a Channel name!"),void Anim.shakeForm();for(var s=[],r=$("#subs-for-channel input"),d=0;d<r.length;d++){var l=$(r[d]).val();l&&s.push(l)}if(0===s.length)return r[0].placeholder="Enter at least one subreddit!",void Anim.shakeForm();switch(a){case"save":var c=u(i);if(c)return n.val(""),n.attr("placeholder","'"+i+"' already exists."),void Anim.shakeForm();b(i,s);break;case"update":w(o),b(i,s)}$(e).remove(),$(".form-left-corner").append("<div class='clr-white txt-bld channel-added-msg'>'"+i+"' "+a+"d. Cool!</div>"),Anim.bounceOut($(".new-form"),Modal.remove)}),UI.el.mainWrap.on("click","#btn-add-channel",function(){Modal.show(a.formAddNew)}),UI.el.mainWrap.on("click",".btn-remove-channel",function(t){t.preventDefault(),w(this.dataset.title)}),UI.el.mainWrap.on("click",".btn-edit-channel",function(t){t.preventDefault(),S(this.dataset.title)})};return{getList:r,getByName:u,getURL:d,loadPosts:g,loadSaved:v,initListeners:x,template:{formAddNew:a.formAddNew,singleEditItem:a.singleEditItem}}}(),Comments=function(){var t,e=!1,n={},a=function(t){e=t},i=function(){return t},o=function(t){location.hash="#comments:"+t},s=function(){var t=location.hash.match(/(#comments:)((?:[a-zA-Z0-9]*))/);if(t&&t[2])return t[2]},r=function(){var t=s();c(t),is.wideScreen&&Posts.markSelected(t)},d=function(t){e=!1;var n="Error loading comments. Refresh to try again.";is.wideScreen?t.addClass("loader-error").html(n+'<button class="btn mrgn-cntr-x mrgn-y blck w-33 js-btn-refresh">Refresh</button>'):t.addClass("loader-error").text(n),is.desktop||UI.el.detailWrap.append($("<section/>"))},l=function(e,a,i){for(var o=(new Date).getTime(),s=new Markdown.Converter,r=$("<div/>").addClass("comments-level"),d=0;d<e.length;d++){var l=e[d];if("t1"===l.kind){var c=s.makeHtml(l.data.body),u=Posts.getList()[t].author===l.data.author,m=URLs.init+Posts.getList()[t].link+l.data.id,p={href:m,target:"_blank",title:"See this comment on reddit.com",tabindex:"-1"},f=$("<div/>").addClass("comment-wrap").attr("tabindex","0").append($("<div/>").append($("<div/>").addClass("comment-data").append($("<span/>").addClass(u?"comment-poster":"comment-author").text(l.data.author)).append($("<a/>").addClass("comment-info no-ndrln").attr(p).text(timeSince(o,l.data.created_utc)))).append($("<div/>").addClass("comment-body").html(c)));l.data.replies&&"more"!==l.data.replies.data.children[0].kind&&(f.append($("<button/>").addClass("btn blck mrgn-cntr-x comments-button js-reply-button").attr("data-comment-id",l.data.id).text("See replies")),n[l.data.id]=l.data.replies.data.children),r.append(f)}}a.append(r),i&&(Posts.getLoaded()[i]=r),UI.el.detailWrap.find("a").attr("target","_blank")},c=function(n,a){if(Posts.getList()[n]){var i=0;Menu.isShowing()&&(Menu.move(UI.Move.LEFT),i=301),setTimeout(function(){if(!e||!t||t!==n){e=!0,t=n,Header.el.btnNavBack.removeClass(UI.classes.invisible);var i=UI.el.detailWrap;if(i.empty(),UI.el.detailWrap[0].scrollTop=0,Posts.getLoaded()[n]&&!a)i.append(Posts.getList()[n].summary),$("#comments-container").append(Posts.getLoaded()[n]),LinkSummary.updatePostSummary(Posts.getList()[n],n),e=!1;else{LinkSummary.setPostSummary(Posts.getList()[n],n);var o=URLs.init+Posts.getList()[n].link+URLs.end,s=UI.addLoader(i);$.ajax({dataType:"jsonp",url:o,success:function(a){t===n&&(LinkSummary.updatePostSummary(a[0].data.children[0].data,n),s.remove(),l(a[1].data.children,$("#comments-container"),n),e=!1)},error:function(){d(s)}})}u(n,a)}},i)}else{t=n;var o=UI.addLoader(UI.el.detailWrap);e=!0,$.ajax({dataType:"jsonp",url:URLs.init+"comments/"+n+"/"+URLs.end,success:function(t){o.remove(),e=!1,Posts.setList(t[0].data),LinkSummary.setPostSummary(t[0].data.children[0].data,n),Header.el.btnNavBack.removeClass(UI.classes.invisible),u(n,a),l(t[1].data.children,$("#comments-container"),n)},error:function(){d(o)}})}},u=function(t,e){var n=Posts.getList()[t].title,a=0;e||Footer.setPostTitle(n),e||UI.getCurrentView()===UI.View.COMMENTS||(Anim.slideFromRight(),a=301),Header.el.centerSection.empty().append(Header.el.postTitle),Header.el.postTitle.text(n),Header.el.subtitle.addClass(UI.classes.invisible),is.wideScreen||setTimeout(function(){UI.el.detailWrap.focus()},a)},m=function(){UI.el.detailWrap.on("click","#comments-container a, #selftext a",function(t){var e=LinkSummary.checkImageLink(this.href);e&&(t.preventDefault(),Modal.showImageViewer(e))}),UI.el.detailWrap.on("click",".js-reply-button",function(){var t=$(this),e=t.attr("data-comment-id"),a=n[e];l(a,t.parent()),is.iOS&&($(".comment-active").removeClass("comment-active"),t.parent().addClass("comment-active")),t.remove()})};return{initListeners:m,navigateFromHash:r,getCurrentThread:i,show:c,updateHash:o,setLoading:a,getIdFromHash:s}}(),CurrentSelection=function(){var t="",e="",n={SUB:1,CHANNEL:2},a="currentSelection",i=function(){return t},o=function(){return e},s=function(n,i){t=n,e=i,Store.setItem(a,JSON.stringify({name:t,type:e}))},r=function(){var i=Store.getItem(a);i&&(i=JSON.parse(i)),t=i?i.name:"frontPage",e=i?i.type:n.SUB},d=function(t){s(t,n.SUB)},l=function(t){s(t.name,n.CHANNEL)},c=function(t,a){switch(e){case n.SUB:t();break;case n.CHANNEL:a()}};return{getName:i,getType:o,Types:n,loadSaved:r,setSubreddit:d,setChannel:l,execute:c}}(),Footer=function(){var t="",e="No Post Selected",n={detail:$("#detail-footer"),postTitle:$("#footer-post"),subTitle:$("#footer-sub"),getRefreshButton:function(){return t||(t=document.querySelector("#main-footer .footer-refresh")),t}},a=function(t){n.postTitle.text(t?t:e);var a=n.detail.find(".btn-footer");t?a.removeClass(UI.classes.hide):a.addClass(UI.classes.hide)};return{el:n,setPostTitle:a}}(),Header=function(){var t={subtitle:$("#main-title"),subtitleText:$("#sub-title"),centerSection:$("#title-head"),postTitle:$("#title"),icon:$("#header-icon"),btnNavBack:$("#nav-back")},e=function(){t.subtitleText.on("click",function(){is.mobile&&Posts.areLoading()||Menu.move(Menu.isShowing()?UI.Move.LEFT:UI.Move.RIGHT)})};return{el:t,initListeners:e}}(),LinkSummary=function(){var t="\n\t\t<section id='link-summary'>\n\t\t\t<a href='{{url}}'\n\t\t\t   target='_blank'\n\t\t\t   class='no-ndrln'>\n\t\t\t\t<span id='summary-title'\n\t\t\t\t\t  class='pad-x txt-bld blck'>{{title}}</span>\n\t\t\t\t<span id='summary-domain'\n\t\t\t\t\t  class='pad-x txt-bld'>{{domain}}</span>\n\t\t\t\t{{#over_18}}\n\t\t\t\t<span class='link-label txt-bld summary-label nsfw'>NSFW</span>\n\t\t\t\t{{/over_18}}\n\t\t\t\t{{#stickied}}\n\t\t\t\t<span class='link-label txt-bld summary-label stickied'>Stickied</span>\n\t\t\t\t{{/stickied}}\n\t\t\t</a>\n\t\t\t<div id='summary-footer'>\n\t\t\t\t<span id='summary-author'\n\t\t\t\t\t  class='pad-x txt-bld'>by {{author}}</span>\n\t\t\t\t<a class='btn mrgn-x no-ndrln'\n\t\t\t\t   id='share-tw'\n\t\t\t\t   target='_blank'\n\t\t\t\t   href='https://twitter.com/intent/tweet?text=\"{{encodedTitle}}\" â€”&url={{url}}&via=ReedditApp&related=ReedditApp'>Tweet</a>\n\t\t\t</div>\n\t\t\t<div class='ls-extra flx flx-spc-btwn-x txt-bld'>\n\t\t\t\t<span class='w-33'\n\t\t\t\t\t  id='summary-sub'>{{subreddit}}</span>\n\t\t\t\t<span class='w-33 txt-cntr'\n\t\t\t\t\t  id='summary-time'></span>\n\t\t\t\t<a class='w-33 no-ndrln txt-r clr-current'\n\t\t\t\t   id='summary-comment-num'\n\t\t\t\t   title='See comments on reddit.com'\n\t\t\t\t   href='http://reddit.com{{link}}'\n\t\t\t\t   target='_blank'>{{num_comments}} comments</a>\n\t\t\t</div>\n\t\t</section>",e=function(e,n){e.link||(e.link=e.permalink);var d=Mustache.to_html(t,e);if(e.selftext){var l;if(Posts.getList()[n].selftextParsed)l=Posts.getList()[n].selftext;else{var c=new Markdown.Converter;l=c.makeHtml(e.selftext),Posts.getList()[n].selftext=l,Posts.getList()[n].selftextParsed=!0}d+="<section id='selftext' class='pad-x mrgn-x mrgn-y'>"+l+"</section>"}else{var u=Posts.getList()[n].url,m=i(u);if(m)d+='<a href="#preview" class="preview-container blck js-img-preview" data-img="'+m+'"><img class="image-preview" src="'+m+'" /></a>';else{var p=o(u);if(p)d+='<a class="preview-container blck" \n\t\t\t\t\t\t\t\thref="'+u+'" \n\t\t\t\t\t\t\t\ttarget="_blank">\n\t\t\t\t\t\t <img class="video-preview" \n\t\t\t\t\t\t      src="//img.youtube.com/vi/'+p+'/hqdefault.jpg"/>\n\t\t\t\t\t\t </a>';else{var f=s(u),h=r(u);f?d+="<div style='position:relative; padding-bottom:56.69%'><iframe src='https://gfycat.com/ifr/"+f+"' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>":h&&(d+="<div style='position:relative; padding-bottom:56.69%'><iframe src='https://redgifs.com/ifr/"+h+"' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>")}}}d+="<section id='comments-container'></section>",UI.el.detailWrap.append(d),a(e.created_utc),Posts.getList()[n].summary=d,Footer.el.postTitle.text(e.title)},n=function(t,e){$("#summary-comment-num").text(t.num_comments+(1===t.num_comments?" comment":" comments")),a(t.created_utc),Posts.getList()[e].num_comments=t.num_comments,Posts.getList()[e].created_utc=t.created_utc},a=function(t){$("#summary-time").text(timeSince((new Date).getTime(),t))},i=function(t){var e=t.match(/\.(svg|jpe?g|png|gifv?)(?:[?#].*)?$|(?:imgur\.com|livememe\.com|reddituploads\.com)\/([^?#\/.]*)(?:[?#].*)?(?:\/)?$/);return e?e[1]?(t.indexOf(".gifv")>0&&(t=t.replace(".gifv",".gif")),t.indexOf("imgur.com")>=0&&(t=t.replace(/^htt(p|ps):/,"")),t):e[2]?"imgur"===e[0].slice(0,5)?"//imgur.com/"+e[2]+".jpg":e[0].indexOf("livememe.")>=0?"http://i.lvme.me/"+e[2]+".jpg":e[0].indexOf("reddituploads.")>=0?e.input:null:null:""},o=function(t){var e=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return e?11===e[2].length?e[2]:null:""},s=function(t){var e=t.match(/gfycat.com\/(gifs\/detail\/)?(\w+)/i);return e?e&&e.length>2?e[2]:null:""},r=function(t){var e=t.match(/redgifs.com\/(?:(?:ifr|watch)\/)(\w+)/i);return e?e&&e.length>1?(console.log(e[1]),e[1]):null:""},d=function(){UI.el.detailWrap.on("click",".js-img-preview",function(t){t.preventDefault(),Modal.showImageViewer(this.dataset.img)})};return{setPostSummary:e,updatePostSummary:n,checkImageLink:i,initListeners:d}}(),Menu=function(){var t={mainMenu:$("#main-menu"),buttonNewSubreddit:$("#btn-new-sub"),buttonNewChannel:$("#btn-new-channel"),buttonAddSubreddits:$("#btn-add-subs"),buttonEditSubreddits:$("#btn-edit-subs"),buttonAbout:$("#about")},e=!1,n=function(){return e},a={about:"<div class='new-form about-reeddit'>"+UI.template.closeModalButton+"<ul><li><a href='/about/' target='_blank'>Reeddit Homepage</a></li><li><a href='https://github.com/berbaquero/reeddit' target='_blank'>GitHub Project</a></li></ul><p><a href='https://twitter.com/reedditapp'>@ReedditApp</a></p><p>Built by <a href='http://berbaquero.com' target='_blank'>Bernardo Baquero Stand</a></p></div>"},i="sub--selected",o="channel--selected",s=function(t){is.iPhone&&is.iOS7&&(UI.el.mainView.removeClass(UI.classes.swipe),UI.el.detailView.removeClass(UI.classes.swipe)),t===UI.Move.LEFT&&(UI.el.mainView.removeClass(UI.classes.showMenu),setTimeout(function(){e=!1},1)),t===UI.Move.RIGHT&&(UI.el.mainView.addClass(UI.classes.showMenu),setTimeout(function(){e=!0},1))},r=function(t){var e=t.type,n=t.el,a=t.name,s=t.update;s&&d();var r=e&&"channel"===e;if(n)return void n.classList.add(r?o:i);if(a){var l=r?'.channel[data-title="'+a+'"]':'.sub[data-name="'+a+'"]',c=document.querySelector(l);c.classList.add(r?o:i)}},d=function(){$(".sub.sub--selected").removeClass(i),$(".channel.channel--selected").removeClass(o)},l=function(){t.mainMenu.on("click",".channel",function(t){t.preventDefault();var e=this,n=e.getAttribute("data-title");Menu.move(UI.Move.LEFT),(n!==CurrentSelection.getName()||Subreddits.isEditing())&&(Menu.markSelected({type:"channel",el:e,update:!0}),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView(),Channels.loadPosts(Channels.getByName(n)))}),t.mainMenu.on("click",".sub",function(t){t.preventDefault();var e=t.target;Menu.move(UI.Move.LEFT),Subreddits.loadPosts(e.dataset.name),r({el:e,update:!0}),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView()}),t.buttonNewSubreddit.on("click",function(t){t.preventDefault(),Modal.show(Subreddits.template.formInsert)}),t.buttonNewChannel.on("click",function(t){t.preventDefault(),Modal.show(Channels.template.formAddNew)}),t.buttonAddSubreddits.on("click",function(t){t.preventDefault(),Subreddits.loadForAdding()}),t.buttonEditSubreddits.on("click",function(t){t.preventDefault(),Subreddits.loadForEditing()}),t.buttonAbout.on("click",function(t){t.preventDefault(),Modal.show(a.about)})};return{isShowing:n,initListeners:l,move:s,markSelected:r,cleanSelected:d,el:t}}(),Modal=function(){var t=!1,e=function(e){t=e},n=function(){return t},a=function(t,a,i){var o=1;!is.largeScreen&&Menu.isShowing()&&(Menu.move(UI.Move.LEFT),o=301),setTimeout(function(){if(!n()){var o=$("<div/>").attr({id:"modal",tabindex:"0","class":"modal"}),s=!0;i&&(i.modalClass&&o.addClass(i.modalClass),i.noBounce&&(s=!1)),o.append(t),UI.el.body.append(o),o.focus(),r(!0),e(!0),setTimeout(function(){o.css("opacity",1),s&&Anim.bounceInDown($(".new-form"))},1),a&&a()}},o)},i=function(){var t=$("#modal");t.css("opacity",""),e(!1),setTimeout(function(){t.remove(),r(!1)},301)},o=function(t){var e='<img class="image-viewer centered-transform" src="'+t+'">',n={modalClass:"modal--closable",noBounce:!0};Modal.show(e,!1,n)},s=function(t){27===t.which&&i()},r=function(t){t?UI.el.body.on("keydown",s):UI.el.body.off("keydown",s)},d=function(){UI.el.body.on("click",".modal--closable",Modal.remove)};return{show:a,remove:i,showImageViewer:o,initListeners:d,isShowing:n}}(),Posts=function(){var t="\n\t\t{{#children}}\n\t\t\t<article class='link-wrap flx w-100'>\n\t\t\t\t<div class='link flx no-ndrln pad-y pad-x js-link' data-id='{{data.id}}'>\n\t\t\t\t\t<div class='link-thumb'>\n\t\t\t\t\t\t<div style='background-image: url({{data.thumbnail}})'></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='link-info'>\n\t\t\t\t\t\t<a href='{{data.url}}'\n\t\t\t\t\t\t   data-id='{{data.id}}'\n\t\t\t\t\t\t   target='_blank'\n\t\t\t\t\t\t   class='link-title no-ndrln blck js-post-title'>\n\t\t\t\t\t\t{{data.title}}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<div class='link-domain'>{{data.domain}}</div>\n\t\t\t\t\t\t<span class='link-sub'>{{data.subreddit}}</span>\n\t\t\t\t\t\t{{#data.over_18}}\n\t\t\t\t\t\t<span class='link-label txt-bld nsfw'>NSFW</span>\n\t\t\t\t\t\t{{/data.over_18}}\n\t\t\t\t\t\t{{#data.stickied}}\n\t\t\t\t\t\t<span class='link-label txt-bld stickied'>Stickied</span>\n\t\t\t\t\t\t{{/data.stickied}}\n\t\t\t\t\t\t<p class=\"tagline \">\n\t\t\t\t\t\t\tsubmitted \n\t\t\t\t\t\t\t<time title=\"{{data.unix_time}}\" class=\"live-timestamp\">\n\t\t\t\t\t\t\t\t{{data.time_ago}}\n\t\t\t\t\t\t\t</time> by \n\t\t\t\t\t\t\t<a href=\"https://old.reddit.com/user/slvrfn\" class=\"author may-blank id-t2_o61cy\">\n\t\t\t\t\t\t\t{{data.author}}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<span class=\"userattrs\"></span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p class=\"tagline \">\n\t\t\t\t\t\t\t<a href=\"{{data.url}}\" data-event-action=\"comments\" class=\"bylink comments may-blank\" rel=\"nofollow\">{{data.comments}}</a>\n\t\t\t\t\t\t\t<a href=\"#\">save</a>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<a href='#comments:{{data.id}}' class='to-comments w-15 flx flx-cntr-y btn-basic'>\n\t\t\t\t\t<div class='comments-icon'></div>\n\t\t\t\t</a>\n\t\t\t</article>\n\t\t{{/children}}\n\t\t<button id='btn-load-more-posts'\n\t\t\t\tclass='btn blck mrgn-cntr-x'>More</button>\n\t\t<div id='main-overflow'></div>",e=!1,n={},a={},i="",o={moreButton:function(){return $("#btn-load-more-posts")}},s=function(){return n},r=function(){return a},d=function(t){e=t},l=function(){return e},c=function(t,e){var a=n[e];a.self||is.wideScreen?Comments.updateHash(e):w(t)},u=function(t,n,a){if(!e){e=!0,Comments.setLoading(!1),Subreddits.setEditing(!1);var i=UI.el.mainWrap;n?(o.moreButton().remove(),i.append(UI.template.loader)):(UI.el.mainWrap[0].scrollTop=0,setTimeout(function(){i.prepend(UI.template.loader)},Menu.isShowing()?301:1),n=""),$.ajax({dataType:"jsonp",url:t+Sorting.get()+URLs.limitEnd+n,success:function(t){if(a){var e=new RegExp(a,"i");console.log(t);var i=t;i.data.children=t.data.children.filter(function(t){return e.test(t.data.title)}),f(i,n),console.log(i,a)}else f(t,n)},error:function(){e=!1,$(".loader").addClass("loader-error").text("Error loading links. Refresh to try again.")}})}},m=function(t){f(t),UI.el.mainWrap[0].scrollTop=0,Subreddits.setEditing(!1)},p=function(e,n){var a=e;console.log(e);for(var i=[],s=0;s<e.children.length;s++){var r=e.children[s];Object.assign(r.data,{time_ago:x(e.children[s].data.created_utc),unix_time:I(e.children[s].data.created_utc),comments:1==e.children[s].data.num_comments?"comment":e.children[s].data.num_comments+" comments"}),i.push(r)}a.children=i,console.log(a);var d=e.children.length,l=UI.el.mainWrap;if(n?$(".loader").remove():is.desktop?l.empty():l.empty().removeClass("anim-reveal").addClass(UI.classes.invisible),0===d){var c=$(".loader");c?(c.text("No Links available.").addClass("loader-error"),l.append('<div id="#main-overflow"></div>')):l.prepend('<div class="loader loader-error">No Links available.</div><div id="main-overflow"></div>')}else{var u=Mustache.to_html(t,a),m=u.replace(/url\(http\:/g,"url(");l.append(m);for(var p=$(".link-thumb > div"),f=0;f<p.length;f++){var h=$(p[f]),b=h.attr("style").replace("background-image: ","");"url()"!==b&&"url(default)"!==b&&"url(nsfw)"!==b&&"url(image)"!==b&&"url(spoiler)"!==b&&"url(self)"!==b||("url(self)"===b?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -444px"):"url(default)"===b?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -225px"):"url(spoiler)"===b?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -371px"):"url(image)"===b?(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -152px"):"url(nsfw)"===b&&(h[0].style.backgroundImage="url(https://www.redditstatic.com/sprite-reddit.vSUv8UUCI2g.png)",h[0].style.backgroundPosition="-5px -298px"))}}d<30&&o.moreButton().remove(),is.desktop||UI.scrollFixLinks(),n||Anim.reveal(l),is.largeScreen||UI.el.mainWrap.focus()},f=function(t,n){var a=t.data;if(e=!1,i=a.after,h(a),p(a,n),is.wideScreen){var o=Comments.getIdFromHash();o&&v(o)}},h=function(t){for(var e=0;e<t.children.length;e++){var a=t.children[e];n[a.data.id]?(n[a.data.id].num_comments=a.data.num_comments,n[a.data.id].created_utc=a.data.created_utc):n[a.data.id]={title:a.data.title,encodedTitle:encodeURI(a.data.title),selftext:a.data.selftext,created_utc:a.data.created_utc,domain:a.data.domain,subreddit:a.data.subreddit,num_comments:a.data.num_comments,url:a.data.url,self:a.data.is_self,link:a.data.permalink,author:a.data.author,over_18:a.data.over_18,stickied:a.data.stickied}}},b=function(){Subreddits.isEditing()||(console.log(CurrentSelection,",,"),CurrentSelection.execute(function(){u("frontpage"===CurrentSelection.getName().toLowerCase()?URLs.init+"r/"+Subreddits.getAllSubsString()+"/":URLs.init+"r/"+CurrentSelection.getName()+"/")},function(){Channels.loadPosts(Channels.getByName(CurrentSelection.getName()))}))},v=function(t){$(".link.link-selected").removeClass("link-selected"),$('.link[data-id="'+t+'"]').addClass("link-selected")},g=function(){$(".link.link-selected").removeClass("link-selected")},w=function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank");var n=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});e.dispatchEvent(n)},S=function(){UI.el.mainWrap.on("click",".js-link",function(t){is.wideScreen&&Comments.updateHash(this.dataset.id)}),UI.el.mainWrap.on("click",".js-post-title",function(t){t.preventDefault();var e=t.target.dataset.id,n=t.target.href;c(n,e)}),UI.el.mainWrap.on("click","#btn-load-more-posts",function(){CurrentSelection.execute(function(){var t;t="frontpage"===CurrentSelection.getName().toLowerCase()?URLs.init+"r/"+Subreddits.getAllSubsString()+"/":URLs.init+"r/"+CurrentSelection.getName()+"/",u(t,"&after="+i)},function(){var t=Channels.getByName(CurrentSelection.getName());u(URLs.init+Channels.getURL(t)+"/","&after="+i)})})},x=function(t){var e=(new Date).getTime(),n=e-1e3*t,a=Math.floor(n/1e3);return a<60?"Just now":a/60<60?Math.floor(a/60)+" minutes ago":a/3600<24?Math.floor(a/3600)+" hours ago":Math.floor(a/86400)+" days ago"},I=function(t){var e=new Date(1e3*t),n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=n[e.getUTCDay()]+" "+a[e.getUTCMonth()]+" "+String(e.getUTCDate()).padStart(2,"0")+" "+String(e.getUTCHours()).padStart(2,"0")+":"+String(e.getUTCMinutes()).padStart(2,"0")+":"+String(e.getUTCSeconds()).padStart(2,"0")+" "+e.getUTCFullYear()+" UTC";return i};return{initListeners:S,load:u,clearSelected:g,refreshStream:b,markSelected:v,loadFromManualInput:m,setLoading:d,areLoading:l,getList:s,setList:h,timeAgo:x,unixTime:I,getLoaded:r}}(),SortSwitch=function(){var t=!0,e={"new":"sort-switch--new"},n="",a={getWrap:function(){return n||(n=document.getElementsByClassName("sorter-wrap")[0]),n},mainSwitch:$(".js-sort-switch-main")},i=function(){a.mainSwitch.on("click",function(n){n.preventDefault();var a=this;Posts.areLoading()||(t=!t,Sorting.change(t?"hot":"new"),t?a.classList.remove(e["new"]):a.classList.add(e["new"]))})};return{el:a,initListeners:i
}}(),Sorting=function(){var t="hot",e=function(){return"hot"!==t?t+"/":""},n=function(e){t=e;var n=1;Menu.isShowing()&&(Menu.move(UI.Move.LEFT),n=301),setTimeout(function(){Posts.refreshStream()},n)};return{get:e,change:n}}(),Subreddits=function(){var t,e=[{subreddit:"frontPage",regex:"f"},{subreddit:"all",regex:"a"},{subreddit:"pics",regex:"p"},{subreddit:"tech",regex:"t"},{subreddit:"cryptocurrencies",regex:"crypto"}],n=[],a="",i=!1,o="sub pad-x pad-y blck no-ndrln txt-cap txt-ellps",s={list:"{{#.}}<a href='#{{subreddit}}' data-name='{{subreddit}}' class='"+o+"'>{{subreddit}}</a>{{/.}}",toEditList:"<div class='edit-subs-title pad-x pad-y txt-bld txt-cntr'>Subreddits</div><ul class='no-mrgn no-pad'>{{#.}}<div class='item-to-edit flx sub-to-remove' data-name='{{subreddit}}'><p class='sub-name w-85 txt-cap txt-bld'>{{subreddit}} (regex: {{regex}})</p><a href='#edit_sub' rid='{{subreddit}}' class='flx flx-cntr-x flx-cntr-y w-15 no-ndrln clr-current btn-edit-sub icon-pencil'></a><a href='#remove' class='no-ndrln clr-current flx flx-cntr-x flx-cntr-y w-15 btn-remove-sub icon-trashcan' data-name='{{subreddit}}'></a></div>{{/.}}</ul>",toAddList:"{{#children}}<div class='sub-to-add flx w-100'><div class='w-85'><p class='sub-to-add__title js-sub-title txt-bld'>{{data.display_name}}</p><p class='sub-to-add__description'>{{data.public_description}}</p></div><a href='#add' class='btn-add-sub no-ndrln flx flx-cntr-x flx-cntr-y w-15 icon-plus-circle'></a></div>{{/children}}",loadMoreSubsButton:"<button class='btn blck w-50 mrgn-y mrgn-cntr-x' id='btn-more-subs'>More</button>",formInsert:'<div class="new-form" id="form-new-sub"><div class="form-left-corner"><button class="btn" id="btn-add-new-sub">Add Subreddit</button></div>'+UI.template.closeModalButton+'<form><input type="text" id="txt-new-sub" placeholder="New subreddit name" /><input type="text" id="txt-new-reg" placeholder="Regex" style="margin-top: 10px;" /></form></div>',formUpdate:'<div class="new-form" id="form-update-sub"><div class="form-left-corner"><button class="btn" id="btn-update-new-sub">Update Subreddit</button></div>'+UI.template.closeModalButton+'<form><input type="text" id="txt-update-sub" placeholder="Subreddit name" /><input type="text" id="txt-update-reg" placeholder="Regex" style="margin-top: 10px;" /></form></div>',topButtonsForAdding:"<div class='flx flx-cntr-x pad-x pad-y'><button id='btn-sub-man' class='btn group-btn'>Insert Manually</button><button id='btn-add-channel' class='btn group-btn'>Create Channel</button></div>"},r={list:$("#subs")},d=function(){return n},l=function(){return i},c=function(t,e){n.push({subreddit:t,regex:e}),Store.setItem("subreeddits",JSON.stringify(n)),Backup.shouldUpdate()},u=function(t){var e=n.findIndex(function(e){return e.subreddit===t});n.splice(e,1),Store.setItem("subreeddits",JSON.stringify(n)),Backup.shouldUpdate()},m=function(t){t instanceof Array?r.list.append(Mustache.to_html(s.list,t)):r.list.append($("<a/>").attr({"data-name":t,href:"#"}).addClass(o).text(t))},p=function(t){var e=$(".sub-to-remove[data-name='"+t+"']");e.addClass("anim-delete"),setTimeout(function(){e.remove()},200),r.list.find(".sub[data-name="+t+"]").remove()},f=function(t){n=t,Store.setItem("subreeddits",JSON.stringify(n)),Backup.shouldUpdate()},h=function(t){if(n){t=t.toLowerCase();for(var e=n.length;--e;){var a=n[e].subreddit;if(a.toLowerCase()===t)return!0}return!1}return!1},b=function(){for(var t="",e="frontpage",a="all",i=0;i<n.length;i++){var o=n[i].subreddit.toLowerCase();o!==e&&o!==a&&(t+=o+"+")}return t.substring(0,t.length-1)},v=function(){var t=Store.getItem("subreeddits");t&&(t=JSON.parse(t)),n=t,n||f(e),m(n)},g=function(t){var n=e.filter(function(e){return e.subreddit.toLowerCase()===t.toLowerCase()});if(t!==CurrentSelection.getName()||i){var a;a="frontpage"===t.toLowerCase()?URLs.init+"r/"+b()+"/":URLs.init+"r/"+t+"/",console.log(a),Posts.load(a,"",n[0].regex),CurrentSelection.setSubreddit(t)}UI.setSubTitle(t)},w=function(t){console.log(t),u(t),p(t),CurrentSelection.getType()===CurrentSelection.Types.SUB&&CurrentSelection.getName()===t&&CurrentSelection.setSubreddit(e[0].subreddit)},S=function(t,e){h(t)||(c(t,e),m(t))},x=function(t,e){var n=localStorage.getItem("update_sub");h(t)||(u(n),p(n),c(t,e),m(t),localStorage.removeItem("update_sub"))},I=function(){var t=$$.id("txt-new-sub"),e=t.value,n=$("#txt-new-reg").val();return e?h(e)?(t.value="",t.setAttribute("placeholder",e+" already added!"),void Anim.shakeForm()):(e=e.trim(),Anim.bounceOut($(".new-form"),Modal.remove),void $.ajax({url:URLs.init+"r/"+e+"/"+Sorting.get()+URLs.limitEnd,dataType:"jsonp",success:function(t){if(n){var a=new RegExp(n,"i"),i=t;i.data.children=t.data.children.filter(function(t){return a.test(t.data.title)}),Posts.loadFromManualInput(i)}else Posts.loadFromManualInput(t);UI.setSubTitle(e),CurrentSelection.setSubreddit(e),S(e,n),Menu.markSelected({name:e,update:!0})},error:function(){alert("Oh, the subreddit you entered is not valid...")}})):(t.setAttribute("placeholder","Enter a subreddit title!"),void Anim.shakeForm())},k=function(){var t=$$.id("txt-update-sub"),e=t.value,n=$("#txt-update-reg").val();return e?h(e)?(t.value="",t.setAttribute("placeholder",e+" already added!"),void Anim.shakeForm()):(e=e.trim(),Anim.bounceOut($(".new-form"),Modal.remove),void $.ajax({url:URLs.init+"r/"+e+"/"+Sorting.get()+URLs.limitEnd,dataType:"jsonp",success:function(t){x(e,n)},error:function(){alert("Oh, the subreddit you entered is not valid...")}})):(t.setAttribute("placeholder","Enter a subreddit title!"),void Anim.shakeForm())},C=function(t){t!==i&&(i=t,is.wideScreen&&(UI.switchDisplay(Footer.el.getRefreshButton(),t),UI.switchDisplay(SortSwitch.el.getWrap(),t)))},U=function(){is.largeScreen||Menu.move(UI.Move.LEFT),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView(),setTimeout(function(){UI.el.mainWrap[0].scrollTop=0;var e=UI.el.mainWrap;t?e.empty().append(s.topButtonsForAdding).append(t).append(s.loadMoreSubsButton):(e.prepend(UI.template.loader).prepend(s.topButtonsForAdding),$.ajax({url:URLs.init+"reddits/.json?limit=50&jsonp=?",dataType:"jsonp",success:function(n){a=n.data.after,t=Mustache.to_html(s.toAddList,n.data),e.empty().append(s.topButtonsForAdding).append(t).append(s.loadMoreSubsButton)},error:function(){$(".loader").addClass("loader-error").text("Error loading subreddits.")}})),Posts.setLoading(!1)},is.largeScreen?1:301),Menu.cleanSelected(),UI.setSubTitle("Add Subs"),C(!0)},y=function(){is.largeScreen||Menu.move(UI.Move.LEFT),UI.getCurrentView()===UI.View.COMMENTS&&UI.backToMainView(),setTimeout(function(){UI.el.mainWrap[0].scrollTop=0;var t=Mustache.to_html(s.toEditList,n),e="",a=Channels.getList();a&&a.length>0&&(e=Mustache.to_html("<div class='edit-subs-title pad-x pad-y txt-bld txt-cntr'>Channels</div><ul class='no-mrgn no-pad channel-edit-list'>{{#.}} "+Channels.template.singleEditItem+"{{/.}}</ul>",a));var i='<div class="h-100">'+e+t+"</div>";setTimeout(function(){UI.el.mainWrap.html(i)},10),Menu.cleanSelected(),Posts.setLoading(!1)},is.largeScreen?1:301),UI.setSubTitle("Edit Subs"),C(!0)},L=function(){UI.el.body.on("submit","#form-new-sub form",function(t){t.preventDefault(),I()}),UI.el.body.on("submit","#form-update-sub form",function(t){t.preventDefault(),k()}),UI.el.body.on("click","#btn-add-new-sub",I),UI.el.body.on("click","#btn-update-new-sub",k),UI.el.body.on("click","#btn-add-another-sub",function(){var t=$("#subs-for-channel");t.append("<input type='text' placeholder='Extra subreddit'/>"),t[0].scrollTop=t.height()}),UI.el.mainWrap.on("click","#btn-sub-man",function(){Modal.show(s.formInsert)}),UI.el.mainWrap.on("click",".btn-edit-sub",function(){var t=$(this).attr("rid"),n=e.filter(function(e){return e.subreddit.toLowerCase()===t.toLowerCase()}),a=n[0].regex;Modal.show(s.formUpdate),setTimeout(function(){localStorage.setItem("update_sub",t),$("#txt-update-sub").val(t),$("#txt-update-reg").val(a)},500)}),UI.el.mainWrap.on("click","#btn-more-subs",function(e){var n=e.target;$(n).remove();var i=UI.el.mainWrap;i.append(UI.template.loader),$.ajax({url:URLs.init+"reddits/"+URLs.end+"&after="+a,dataType:"jsonp",success:function(e){var n=Mustache.to_html(s.toAddList,e.data);a=e.data.after,$(".loader",i).remove(),i.append(n).append(s.loadMoreSubsButton),t+=n},error:function(){$(".loader").addClass("loader-error").text("Error loading more subreddits.")}})}),UI.el.mainWrap.on("click",".btn-add-sub",function(t){t.preventDefault();var e=$(this).parent(),n=$(".js-sub-title",e);n.css("color","#2b9900");var a=n.text();S(a,"")}),UI.el.mainWrap.on("click",".btn-remove-sub",function(t){t.preventDefault(),w(this.dataset.name)})};return{getList:d,getAllSubsString:b,setEditing:C,isEditing:l,loadPosts:g,loadForEditing:y,loadForAdding:U,loadSaved:v,initListeners:L,template:{formInsert:s.formInsert}}}(),Anim=function(){var t=function(){var t=UI.classes.showView;UI.el.mainView.addClass(t),UI.el.detailView.removeClass(t),UI.setCurrentView(UI.View.MAIN)},e=function(){var t=UI.classes.showView;UI.el.mainView.removeClass(t),UI.el.detailView.addClass(t),UI.setCurrentView(UI.View.COMMENTS)},n=function r(t){var r="anim-reveal";is.desktop?(t.addClass(r),setTimeout(function(){t.removeClass(r)},700)):setTimeout(function(){t.removeClass(UI.classes.invisible).addClass(r)},0)},a=function d(t){var d="anim-shake";t.addClass(d),setTimeout(function(){t.removeClass(d)},350)},i=function(){a($(".new-form"))},o=function l(t,e){var l="anim-bounce-out";t.addClass(l),e&&setTimeout(e,1e3)},s=function(t){t.addClass("anim-bounceInDown"),setTimeout(function(){t[0].style.opacity=1,t.removeClass("anim-bounceInDown")},500)};return{slideFromLeft:t,slideFromRight:e,reveal:n,shake:a,shakeForm:i,bounceOut:o,bounceInDown:s}}(),$$={id:function(t){return document.getElementById(t)},q:function(t){return document.querySelector(t)}},wideScreenBP=window.matchMedia("(min-width: 1000px)"),largeScreenBP=window.matchMedia("(min-width: 490px)"),UA=window.navigator.userAgent,is=function(){var t=!/iPhone|iPod|iPad|Android|Mobile/.test(UA),e=/iPad/.test(UA),n=/iP(hone|od)/.test(UA),a=n||e,i=function(){return a?parseInt(UA.match(/ OS (\d+)_/i)[1],10):0}();return{wideScreen:wideScreenBP.matches,largeScreen:largeScreenBP.matches,desktop:t,mobile:!t,iPhone:n,iPad:e,iOS:a,iOS7:a&&i>=7}}(),Store=window.fluid?allCookies:window.localStorage,ThemeSwitcher=function(){var t=["classic","light","dark"],e=0,n={switcherButton:$("#switch-theme")},a=function(){var t=s(),e=r();UI.el.body.removeClass(t),i(e)},i=function(t){UI.el.body.addClass(t),o(t),d(t)},o=function(t){n.switcherButton.text("Theme: "+t)},s=function(){return t[e]},r=function(){return e++,e===t.length&&(e=0),t[e]},d=function(t){Store.setItem("theme",t)},l=function(){return Store.getItem("theme")},c=function(){var n=l();n?u(n):i(is.iOS7?t[1]:t[e])},u=function(n){s()!==n&&(i(n),e=t.indexOf(n))},m=function(){c(),n.switcherButton.on("click",function(t){t.preventDefault(),a()})};return{init:m}}(),URLs={init:window.location.protocol+"//www.reddit.com/",end:".json?jsonp=?",limitEnd:".json?limit=30&jsonp=?"};if(UI.initListeners(),Posts.initListeners(),Comments.initListeners(),Subreddits.initListeners(),Channels.initListeners(),Menu.initListeners(),Header.initListeners(),Modal.initListeners(),SortSwitch.initListeners(),Backup.initListeners(),LinkSummary.initListeners(),Header.el.postTitle.remove(),is.wideScreen&&Footer.el.postTitle.text(""),CurrentSelection.loadSaved(),Subreddits.loadSaved(),Channels.loadSaved(),location.hash&&Comments.navigateFromHash(),CurrentSelection.execute(function(){var t=CurrentSelection.getName();Menu.markSelected({name:t}),t.toUpperCase()==="frontPage".toUpperCase()?(CurrentSelection.setSubreddit("frontPage"),Posts.load(URLs.init+"r/"+Subreddits.getAllSubsString()+"/")):Posts.load(URLs.init+"r/"+t+"/"),UI.setSubTitle(t)},function(){var t=Channels.getByName(CurrentSelection.getName());Menu.markSelected({type:"channel",name:t.name}),Channels.loadPosts(t)}),ThemeSwitcher.init(),is.mobile){UI.scrollTop();var touch="touchmove";$$.id("edit-subs").addEventListener(touch,function(t){t.preventDefault()},!1),document.getElementsByTagName("header")[0].addEventListener(touch,function(t){Menu.isShowing()&&t.preventDefault()},!1),is.iPad&&UI.iPadScrollFix(),is.iOS7&&document.body.classList.add("ios7")}FastClick.attach(document.body);